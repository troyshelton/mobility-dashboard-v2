;*** Generated by translate command; please verify contents before re-including in CCL ***
DROP PROGRAM   1_mhn_mp_ptlst_custom_01 : DBA  GO
CREATE PROGRAM  1_mhn_mp_ptlst_custom_01 : DBA
 
DECLARE  ENCNTR_ORG_SEC_IND  =  I4  WITH  NOCONSTANT (0 )
 
DECLARE  CONFID_IND  =  I4  WITH  NOCONSTANT (0 )
 
DECLARE  LOCX  =  I4  WITH  NOCONSTANT (0 )
 
DECLARE  LOCY  =  I4  WITH  NOCONSTANT (0 )
 
DECLARE  LOCZ  =  I4  WITH  NOCONSTANT (0 )
 
DECLARE  SERVICEX  =  I4  WITH  NOCONSTANT (0 )
 
DECLARE  VISITX  =  I4  WITH  NOCONSTANT (0 )
 
DECLARE  TYPEX  =  I4  WITH  NOCONSTANT (0 )
 
DECLARE  LIFEX  =  I4  WITH  NOCONSTANT (0 )
 
DECLARE  TIMEDIFFSET  =  I2  WITH  NOCONSTANT (0 )
 
DECLARE  BED_LEVEL  =  I2  WITH  CONSTANT (0 )
 
DECLARE  ROOM_LEVEL  =  I2  WITH  CONSTANT (1 )
 
DECLARE  UNIT_LEVEL  =  I2  WITH  CONSTANT (2 )
 
DECLARE  BUILDING_LEVEL  =  I2  WITH  CONSTANT (3 )
 
DECLARE  FACILITY_LEVEL  =  I2  WITH  CONSTANT (4 )
 
DECLARE  NOTIMEPARAMETER  =  I2  WITH  CONSTANT (0 )
 
DECLARE  LAGTIMEPARAMETER  =  I2  WITH  CONSTANT (1 )
 
DECLARE  RECENTTIMEPARAMETER  =  I2  WITH  CONSTANT (2 )
 
DECLARE  TIMERANGEPARAMETER  =  I2  WITH  CONSTANT (3 )
 
DECLARE  EXAMINEORGSECURITY (( X = I4 )) =  NULL
 
DECLARE  INITIALIZECRITERIA (( X = I4 )) =  NULL
 
DECLARE  PARSEARGUMENTS (( X = I4 )) =  NULL
 
DECLARE  PARSEFILTERS (( X = I4 )) =  NULL
 
DECLARE  ADDLOCATION (( LOCCD = F8 )) =  NULL
 
DECLARE  ADDRESOURCE (( RESCD = F8 )) =  NULL
 
DECLARE  ADDSERVICE (( SERVICECD = F8 )) =  NULL
 
DECLARE  ADDENCNTRTYPE (( TYPECD = F8 )) =  NULL
 
DECLARE  ADDENCNTRCLASS (( CLASSCD = F8 )) =  NULL
 
DECLARE  ADDENCNTRSTATUS (( STATUSCD = F8 )) =  NULL
 
DECLARE  ADDVISITRELTN (( RELTNCD = F8 )) =  NULL
 
DECLARE  ADDLIFETIMERELTN (( RELTNCD = F8 )) =  NULL
 
DECLARE  ADDRELTN (( RELTNCD = F8 )) =  NULL
 
DECLARE  ADDCARETEAM (( GROUPID = F8 )) =  NULL
 
DECLARE  ADDPRSNLGROUP (( GROUPID = F8 )) =  NULL
 
DECLARE  ADDPROVIDERGROUP (( GROUPID = F8 )) =  NULL
 
DECLARE  SETLAGMINUTES (( MINS = I4 )) =  NULL
 
DECLARE  SETRECENTMINUTES (( MINS = I4 )) =  NULL
 
DECLARE  SETADMITMINUTES (( MINS = I4 )) =  NULL
 
DECLARE  SETLOOKFORWARDADMITMINUTES (( MINS = I4 )) =  NULL
 
DECLARE  SETDISCHARGEMINUTES (( MINS = I4 )) =  NULL
 
DECLARE  SETBEGINDT (( DTSTRING = VC )) =  NULL
 
DECLARE  SETENDDT (( DTSTRING = VC )) =  NULL
 
DECLARE  STANDARDIZELOCATIONS (( NORMALIZELOCATIONS = I4 )) =  NULL
 
DECLARE  POPULATESCHEDULELOCATIONS (( X = I4 )) =  NULL
 
DECLARE  STANDARDIZEENCNTRCLASSES (( X = I4 )) =  NULL
 
DECLARE  SETBEGINTM (( DTSTRING = VC )) =  NULL
 
DECLARE  SETENDTM (( DTSTRING = VC )) =  NULL
 
DECLARE  SETBEGINDTTM (( DTSTRING = VC )) =  NULL
 
DECLARE  SETENDDTTM (( DTSTRING = VC )) =  NULL
 
DECLARE  DETERMINEDTTMSHIFT (( X = I4 )) =  NULL
 
DECLARE  PERFORMBESTENCNTR (( X = I4 )) =  NULL
 
DECLARE  PERFORMORGSECURITY (( X = I4 )) =  NULL
 
DECLARE  PERFORMRELATIONSHIPOVERRIDES (( X = I4 )) =  NULL
 
DECLARE  REMOVEFILTEREDPATIENTS (( X = I4 )) =  NULL
 
DECLARE  ASSIGNPRIORITIES (( X = I4 )) =  NULL
 
DECLARE  PARSEENCOUNTERBYENCNTR (( ALIAS = VC ), ( USECENSUSCRITIERIA = I2 )) =  NULL
 
DECLARE  PARSEEPR (( ALIAS = VC )) =  NULL
 
DECLARE  PARSEPPR (( ALIAS = VC )) =  NULL
 
FREE SET CRITERIA
 
RECORD  CRITERIA  (
1  BEST_ENCNTR_FLAG  =  I4
1  TIME_FRAME_FLAG  =  I4
1  BEG_EFFECTIVE_DT_TM  =  DQ8
1  END_EFFECTIVE_DT_TM  =  DQ8
1  ADMIT_FLAG  =  I2
1  ADMIT_DT_TM  =  DQ8
1  LOOKFORWARD_ADMIT_FLAG  =  I2
1  LOOKFORWARD_ADMIT_DT_TM  =  DQ8
1  DISCHARGE_FLAG  =  I2
1  DISCH_DT_TM  =  DQ8
1  LOCATIONS
2  LEVEL  =  I2
2  GROUP_CNT  =  I4
2  GROUPS [*]
3  GROUP_CD  =  F8
2  FACILITY_CNT  =  I4
2  FACILITIES [*]
3  FACILITY_CD  =  F8
2  BUILDING_CNT  =  I4
2  BUILDINGS [*]
3  BUILDING_CD  =  F8
2  UNIT_CNT  =  I4
2  UNITS [*]
3  UNIT_CD  =  F8
2  ROOM_CNT  =  I4
2  ROOMS [*]
3  ROOM_CD  =  F8
2  BED_CNT  =  I4
2  BEDS [*]
3  BED_CD  =  F8
1  SERVICE_CNT  =  I4
1  SERVICES [*]
2  SERVICE_CD  =  F8
1  TYPE_CNT  =  I4
1  TYPES [*]
2  ENCNTR_TYPE_CD  =  F8
1  CLASS_CNT  =  I4
1  CLASSES [*]
2  ENCNTR_CLASS_CD  =  F8
1  STATUS_CNT  =  I4
1  STATUSES [*]
2  ENCNTR_STATUS_CD  =  F8
1  RELTN_PRSNL_ID  =  F8
1  VRELTN_CNT  =  I4
1  VRELTNS [*]
2  VRELTN_CD  =  F8
1  LRELTN_CNT  =  I4
1  LRELTNS [*]
2  LRELTN_CD  =  F8
1  CARETEAM_CNT  =  I4
1  CARETEAMS [*]
2  GROUP_ID  =  F8
1  PROVIDER_GRP_CNT  =  I4
1  PROVIDER_GRPS [*]
2  GROUP_ID  =  F8
1  BEGIN_DT_TM  =  DQ8
1  BEGIN_TZ  =  I4
1  END_DT_TM  =  DQ8
1  END_TZ  =  I4
1  SCHEDULE_LOCATION_CNT  =  I4
1  SCHEDULE_LOCATIONS [*]
2  LOC_CD  =  F8
1  RESOURCE_CNT  =  I4
1  RESOURCES [*]
2  RESOURCE_CD  =  F8 )
 
SUBROUTINE   EXAMINEORGSECURITY  ( X  )
 
IF (  VALIDATE ( CCLDMINFO , 1 ) )
SET  ENCNTR_ORG_SEC_IND  =  CCLDMINFO -> SEC_ORG_RELTN
SET  CONFID_IND  =  CCLDMINFO -> SEC_CONFID
ELSE
SELECT  INTO "nl:"
FROM ( DM_INFO  DI )
 PLAN ( DI
WHERE (DI.INFO_DOMAIN="SECURITY" ) AND (DI.INFO_NAME IN ("SEC_ORG_RELTN" ,
"SEC_CONFID" )))
 
 
DETAIL
 
IF ( (DI.INFO_NAME="SEC_ORG_RELTN" ) AND (DI.INFO_NUMBER=1 ) )  ENCNTR_ORG_SEC_IND =1
ELSEIF ( (DI.INFO_NAME="SEC_CONFID" ) AND (DI.INFO_NUMBER=1 ) )  ENCNTR_ORG_SEC_IND =1 ,
 CONFID_IND =1
ENDIF
 
 WITH  NOCOUNTER
ENDIF
 
 
END ;Subroutine
 
 
SUBROUTINE   INITIALIZECRITERIA  ( X  )
 
SET  CRITERIA -> BEST_ENCNTR_FLAG  = 0
SET  CRITERIA -> TIME_FRAME_FLAG  =  NOTIMEPARAMETER
SET  CRITERIA -> BEG_EFFECTIVE_DT_TM  =  CNVTDATETIME ("01-JAN-1700 00:00:00" )
SET  CRITERIA -> END_EFFECTIVE_DT_TM  =  CNVTDATETIME ( CURDATE ,  CURTIME3 )
SET  CRITERIA -> BEGIN_TZ  =  CURTIMEZONEAPP
SET  CRITERIA -> END_TZ  =  CURTIMEZONEAPP
SET  CRITERIA -> ADMIT_FLAG  = 0
SET  CRITERIA -> DISCHARGE_FLAG  = 0
SET  CRITERIA -> LOOKFORWARD_ADMIT_FLAG  = 0
SET  CRITERIA -> DISCH_DT_TM  =  CNVTDATETIME ( CURDATE ,  CURTIME3 )
SET  CRITERIA -> LOCATIONS -> LEVEL  =  FACILITY_LEVEL
SET  CRITERIA -> LOCATIONS -> GROUP_CNT  = 0
SET  CRITERIA -> LOCATIONS -> FACILITY_CNT  = 0
SET  CRITERIA -> LOCATIONS -> BUILDING_CNT  = 0
SET  CRITERIA -> LOCATIONS -> UNIT_CNT  = 0
SET  CRITERIA -> LOCATIONS -> ROOM_CNT  = 0
SET  CRITERIA -> LOCATIONS -> BED_CNT  = 0
SET  CRITERIA -> SERVICE_CNT  = 0
SET  CRITERIA -> TYPE_CNT  = 0
SET  CRITERIA -> CLASS_CNT  = 0
SET  CRITERIA -> STATUS_CNT  = 0
SET  CRITERIA -> VRELTN_CNT  = 0
SET  CRITERIA -> LRELTN_CNT  = 0
SET  CRITERIA -> RELTN_PRSNL_ID  = 0.0
 
END ;Subroutine
 
 
SUBROUTINE   ADDLOCATION  ( LOCCD  )
 
DECLARE  LOCATIONTYPE  =  VC  WITH  NOCONSTANT ( FILLSTRING (50 , " " ))
SET  LOCATIONTYPE  =  UAR_GET_CODE_MEANING ( LOCCD )
IF ( ( LOCATIONTYPE ="PATLISTROOT" ) )
SET  CRITERIA -> LOCATIONS -> GROUP_CNT  = ( CRITERIA -> LOCATIONS -> GROUP_CNT +1 )
SET  STAT  =  ALTERLIST ( CRITERIA -> LOCATIONS -> GROUPS ,  CRITERIA -> LOCATIONS -> GROUP_CNT )
SET  CRITERIA -> LOCATIONS -> GROUPS [ CRITERIA -> LOCATIONS -> GROUP_CNT ]-> GROUP_CD  =  LOCCD
SET  CRITERIA -> LOCATIONS -> LEVEL  =  MINVAL ( CRITERIA -> LOCATIONS -> LEVEL ,  UNIT_LEVEL )
ELSEIF ( ( LOCATIONTYPE ="FACILITY" ) )
SET  CRITERIA -> LOCATIONS -> FACILITY_CNT  = ( CRITERIA -> LOCATIONS -> FACILITY_CNT +1 )
SET  STAT  =  ALTERLIST ( CRITERIA -> LOCATIONS -> FACILITIES ,  CRITERIA -> LOCATIONS ->
 FACILITY_CNT )
SET  CRITERIA -> LOCATIONS -> FACILITIES [ CRITERIA -> LOCATIONS -> FACILITY_CNT ]-> FACILITY_CD  =
 LOCCD
SET  CRITERIA -> LOCATIONS -> LEVEL  =  MINVAL ( CRITERIA -> LOCATIONS -> LEVEL ,  FACILITY_LEVEL )
ELSEIF ( ( LOCATIONTYPE ="BUILDING" ) )
SET  CRITERIA -> LOCATIONS -> BUILDING_CNT  = ( CRITERIA -> LOCATIONS -> BUILDING_CNT +1 )
IF ( ( MOD ( CRITERIA -> LOCATIONS -> BUILDING_CNT , 10 )=1 ) )
SET  STAT  =  ALTERLIST ( CRITERIA -> LOCATIONS -> BUILDINGS , ( CRITERIA -> LOCATIONS ->
 BUILDING_CNT +9 ))
ENDIF
 
SET  CRITERIA -> LOCATIONS -> BUILDINGS [ CRITERIA -> LOCATIONS -> BUILDING_CNT ]-> BUILDING_CD  =
 LOCCD
SET  CRITERIA -> LOCATIONS -> LEVEL  =  MINVAL ( CRITERIA -> LOCATIONS -> LEVEL ,  BUILDING_LEVEL )
ELSEIF (  (( ( LOCATIONTYPE ="NURSEUNIT" ) )  OR  ( (( ( LOCATIONTYPE ="AMBULATORY" ) )  OR  ((
 LOCATIONTYPE ="ANCILSURG" ) ))  ))  )
SET  CRITERIA -> LOCATIONS -> UNIT_CNT  = ( CRITERIA -> LOCATIONS -> UNIT_CNT +1 )
IF ( ( MOD ( CRITERIA -> LOCATIONS -> UNIT_CNT , 10 )=1 ) )
SET  STAT  =  ALTERLIST ( CRITERIA -> LOCATIONS -> UNITS , ( CRITERIA -> LOCATIONS -> UNIT_CNT +9 ))
ENDIF
 
SET  CRITERIA -> LOCATIONS -> UNITS [ CRITERIA -> LOCATIONS -> UNIT_CNT ]-> UNIT_CD  =  LOCCD
SET  CRITERIA -> LOCATIONS -> LEVEL  =  MINVAL ( CRITERIA -> LOCATIONS -> LEVEL ,  UNIT_LEVEL )
ELSEIF ( ( LOCATIONTYPE ="ROOM" ) )
SET  CRITERIA -> LOCATIONS -> ROOM_CNT  = ( CRITERIA -> LOCATIONS -> ROOM_CNT +1 )
IF ( ( MOD ( CRITERIA -> LOCATIONS -> ROOM_CNT , 10 )=1 ) )
SET  STAT  =  ALTERLIST ( CRITERIA -> LOCATIONS -> ROOMS , ( CRITERIA -> LOCATIONS -> ROOM_CNT +9 ))
ENDIF
 
SET  CRITERIA -> LOCATIONS -> ROOMS [ CRITERIA -> LOCATIONS -> ROOM_CNT ]-> ROOM_CD  =  LOCCD
SET  CRITERIA -> LOCATIONS -> LEVEL  =  MINVAL ( CRITERIA -> LOCATIONS -> LEVEL ,  ROOM_LEVEL )
ELSEIF ( ( LOCATIONTYPE ="BED" ) )
SET  CRITERIA -> LOCATIONS -> BED_CNT  = ( CRITERIA -> LOCATIONS -> BED_CNT +1 )
IF ( ( MOD ( CRITERIA -> LOCATIONS -> BED_CNT , 10 )=1 ) )
SET  STAT  =  ALTERLIST ( CRITERIA -> LOCATIONS -> BEDS , ( CRITERIA -> LOCATIONS -> BED_CNT +9 ))
ENDIF
 
SET  CRITERIA -> LOCATIONS -> BEDS [ CRITERIA -> LOCATIONS -> BED_CNT ]-> BED_CD  =  LOCCD
SET  CRITERIA -> LOCATIONS -> LEVEL  =  MINVAL ( CRITERIA -> LOCATIONS -> LEVEL ,  BED_LEVEL )
ENDIF
 
 
END ;Subroutine
 
 
SUBROUTINE   ADDRESOURCE  ( RESCD  )
 
SET  CRITERIA -> RESOURCE_CNT  = ( CRITERIA -> RESOURCE_CNT +1 )
SET  STAT  =  ALTERLIST ( CRITERIA -> RESOURCES ,  CRITERIA -> RESOURCE_CNT )
SET  CRITERIA -> RESOURCES [ CRITERIA -> RESOURCE_CNT ]-> RESOURCE_CD  =  RESCD
 
END ;Subroutine
 
 
SUBROUTINE   STANDARDIZELOCATIONS  ( NORMALIZE  )
 
DECLARE  ROOMCNT  =  I4  WITH  CONSTANT ( CRITERIA -> LOCATIONS -> ROOM_CNT )
DECLARE  BEDCNT  =  I4  WITH  CONSTANT ( CRITERIA -> LOCATIONS -> BED_CNT )
DECLARE  ROOMADDITIONS  =  I4  WITH  NOCONSTANT (0 )
IF ( ( CRITERIA -> LOCATIONS -> GROUP_CNT >0 ) )
SELECT  INTO "nl:"
FROM ( LOCATION_GROUP  LG )
 
WHERE  EXPAND ( LOCX , 1 ,  CRITERIA -> LOCATIONS -> GROUP_CNT , LG.ROOT_LOC_CD,  CRITERIA ->
 LOCATIONS -> GROUPS [ LOCX ]-> GROUP_CD ) AND (LG.ACTIVE_IND=1 ) AND (LG.END_EFFECTIVE_DT_TM>=
 CNVTDATETIME ( CURDATE ,  CURTIME3 )) AND  NOT ( EXPAND ( LOCY , 1 ,  CRITERIA -> LOCATIONS ->
 UNIT_CNT , LG.CHILD_LOC_CD,  CRITERIA -> LOCATIONS -> UNITS [ LOCY ]-> UNIT_CD ) )
ORDER BY LG.CHILD_LOC_CD
 
HEAD LG.CHILD_LOC_CD
 CRITERIA -> LOCATIONS -> UNIT_CNT =( CRITERIA -> LOCATIONS -> UNIT_CNT +1 ),
IF ( ( MOD ( CRITERIA -> LOCATIONS -> UNIT_CNT , 10 )=1 ) )  STAT = ALTERLIST ( CRITERIA ->
 LOCATIONS -> UNITS , ( CRITERIA -> LOCATIONS -> UNIT_CNT +9 ))
ENDIF
, CRITERIA -> LOCATIONS -> UNITS [ CRITERIA -> LOCATIONS -> UNIT_CNT ]-> UNIT_CD =LG.CHILD_LOC_CD
 WITH  NOCOUNTER
ENDIF
 
IF ( ( CRITERIA -> LOCATIONS -> FACILITY_CNT >0 ) AND ( CRITERIA -> LOCATIONS -> LEVEL <
 FACILITY_LEVEL ) )
SELECT  INTO "nl:"
FROM ( LOCATION_GROUP  LG )
 PLAN ( LG
WHERE  EXPAND ( LOCX , 1 ,  CRITERIA -> LOCATIONS -> FACILITY_CNT , LG.PARENT_LOC_CD,  CRITERIA ->
 LOCATIONS -> FACILITIES [ LOCX ]-> FACILITY_CD ) AND ((LG.ROOT_LOC_CD+0 )=0.0 ) AND (LG.ACTIVE_IND=
1 ) AND (LG.END_EFFECTIVE_DT_TM>= CNVTDATETIME ( CURDATE ,  CURTIME3 )) AND  NOT ( EXPAND ( LOCY ,
1 ,  CRITERIA -> LOCATIONS -> BUILDING_CNT , LG.CHILD_LOC_CD,  CRITERIA -> LOCATIONS -> BUILDINGS [
 LOCY ]-> BUILDING_CD ) ))
 
ORDER BY LG.CHILD_LOC_CD
 
HEAD LG.CHILD_LOC_CD
 CRITERIA -> LOCATIONS -> BUILDING_CNT =( CRITERIA -> LOCATIONS -> BUILDING_CNT +1 ),
IF ( ( MOD ( CRITERIA -> LOCATIONS -> BUILDING_CNT , 10 )=1 ) )  STAT = ALTERLIST ( CRITERIA ->
 LOCATIONS -> BUILDINGS , ( CRITERIA -> LOCATIONS -> BUILDING_CNT +9 ))
ENDIF
, CRITERIA -> LOCATIONS -> BUILDINGS [ CRITERIA -> LOCATIONS -> BUILDING_CNT ]-> BUILDING_CD =
LG.CHILD_LOC_CD
 WITH  NOCOUNTER
ENDIF
 
IF ( ( CRITERIA -> LOCATIONS -> BUILDING_CNT >0 ) AND ( CRITERIA -> LOCATIONS -> LEVEL <
 BUILDING_LEVEL ) )
SELECT  INTO "nl:"
FROM ( LOCATION_GROUP  LG )
 
WHERE  EXPAND ( LOCX , 1 ,  CRITERIA -> LOCATIONS -> BUILDING_CNT , LG.PARENT_LOC_CD,  CRITERIA ->
 LOCATIONS -> BUILDINGS [ LOCX ]-> BUILDING_CD ) AND ((LG.ROOT_LOC_CD+0 )=0.0 ) AND (LG.ACTIVE_IND=
1 ) AND (LG.END_EFFECTIVE_DT_TM>= CNVTDATETIME ( CURDATE ,  CURTIME3 )) AND  NOT ( EXPAND ( LOCY ,
1 ,  CRITERIA -> LOCATIONS -> UNIT_CNT , LG.CHILD_LOC_CD,  CRITERIA -> LOCATIONS -> UNITS [ LOCY ]->
 UNIT_CD ) )
ORDER BY LG.CHILD_LOC_CD
 
HEAD LG.CHILD_LOC_CD
 CRITERIA -> LOCATIONS -> UNIT_CNT =( CRITERIA -> LOCATIONS -> UNIT_CNT +1 ),
IF ( ( MOD ( CRITERIA -> LOCATIONS -> UNIT_CNT , 10 )=1 ) )  STAT = ALTERLIST ( CRITERIA ->
 LOCATIONS -> UNITS , ( CRITERIA -> LOCATIONS -> UNIT_CNT +9 ))
ENDIF
, CRITERIA -> LOCATIONS -> UNITS [ CRITERIA -> LOCATIONS -> UNIT_CNT ]-> UNIT_CD =LG.CHILD_LOC_CD
 WITH  NOCOUNTER
ENDIF
 
IF ( ( CRITERIA -> LOCATIONS -> UNIT_CNT >0 ) AND ( CRITERIA -> LOCATIONS -> LEVEL < UNIT_LEVEL ) )
SELECT  INTO "nl:"
FROM ( LOCATION_GROUP  LG )
 
WHERE  EXPAND ( LOCX , 1 ,  CRITERIA -> LOCATIONS -> UNIT_CNT , LG.PARENT_LOC_CD,  CRITERIA ->
 LOCATIONS -> UNITS [ LOCX ]-> UNIT_CD ) AND ((LG.ROOT_LOC_CD+0 )=0.0 ) AND (LG.ACTIVE_IND=1 ) AND (
LG.END_EFFECTIVE_DT_TM>= CNVTDATETIME ( CURDATE ,  CURTIME3 )) AND  NOT ( EXPAND ( LOCY , 1 ,
 CRITERIA -> LOCATIONS -> ROOM_CNT , LG.CHILD_LOC_CD,  CRITERIA -> LOCATIONS -> ROOMS [ LOCY ]->
 ROOM_CD ) )
ORDER BY LG.CHILD_LOC_CD
 
HEAD LG.CHILD_LOC_CD
 CRITERIA -> LOCATIONS -> ROOM_CNT =( CRITERIA -> LOCATIONS -> ROOM_CNT +1 ),
IF ( ( MOD ( CRITERIA -> LOCATIONS -> ROOM_CNT , 10 )=1 ) )  STAT = ALTERLIST ( CRITERIA ->
 LOCATIONS -> ROOMS , ( CRITERIA -> LOCATIONS -> ROOM_CNT +9 ))
ENDIF
, CRITERIA -> LOCATIONS -> ROOMS [ CRITERIA -> LOCATIONS -> ROOM_CNT ]-> ROOM_CD =LG.CHILD_LOC_CD
 WITH  NOCOUNTER
ENDIF
 
IF ( ( CRITERIA -> LOCATIONS -> ROOM_CNT >0 ) AND ( CRITERIA -> LOCATIONS -> LEVEL < ROOM_LEVEL ) )
SELECT  INTO "nl:"
FROM ( LOCATION_GROUP  LG )
 
WHERE  EXPAND ( LOCX , 1 ,  CRITERIA -> LOCATIONS -> ROOM_CNT , LG.PARENT_LOC_CD,  CRITERIA ->
 LOCATIONS -> ROOMS [ LOCX ]-> ROOM_CD ) AND ((LG.ROOT_LOC_CD+0 )=0.0 ) AND (LG.ACTIVE_IND=1 ) AND (
LG.END_EFFECTIVE_DT_TM>= CNVTDATETIME ( CURDATE ,  CURTIME3 )) AND  NOT ( EXPAND ( LOCY , 1 ,
 CRITERIA -> LOCATIONS -> BED_CNT , LG.CHILD_LOC_CD,  CRITERIA -> LOCATIONS -> BEDS [ LOCY ]->
 BED_CD ) )
ORDER BY LG.CHILD_LOC_CD
 
HEAD LG.CHILD_LOC_CD
 CRITERIA -> LOCATIONS -> BED_CNT =( CRITERIA -> LOCATIONS -> BED_CNT +1 ),
IF ( ( MOD ( CRITERIA -> LOCATIONS -> BED_CNT , 10 )=1 ) )  STAT = ALTERLIST ( CRITERIA ->
 LOCATIONS -> BEDS , ( CRITERIA -> LOCATIONS -> BED_CNT +9 ))
ENDIF
, CRITERIA -> LOCATIONS -> BEDS [ CRITERIA -> LOCATIONS -> BED_CNT ]-> BED_CD =LG.CHILD_LOC_CD
 WITH  NOCOUNTER
ENDIF
 
IF (  NORMALIZE  )
IF ( ( BEDCNT >0 ) )
SELECT  INTO "nl:"
FROM ( LOCATION_GROUP  LG )
 
WHERE  EXPAND ( LOCX , 1 ,  BEDCNT , LG.CHILD_LOC_CD,  CRITERIA -> LOCATIONS -> BEDS [ LOCX ]->
 BED_CD ) AND  NOT ( EXPAND ( LOCY , 1 ,  CRITERIA -> LOCATIONS -> ROOM_CNT , LG.PARENT_LOC_CD,
 CRITERIA -> LOCATIONS -> ROOMS [ LOCY ]-> ROOM_CD ) ) AND ((LG.ROOT_LOC_CD+0 )=0.0 ) AND (
LG.ACTIVE_IND=1 ) AND (LG.END_EFFECTIVE_DT_TM>= CNVTDATETIME ( CURDATE ,  CURTIME3 ))
ORDER BY LG.PARENT_LOC_CD
 
HEAD LG.PARENT_LOC_CD
 ROOMADDITIONS =( ROOMADDITIONS +1 ), CRITERIA -> LOCATIONS -> ROOM_CNT =( CRITERIA -> LOCATIONS ->
 ROOM_CNT +1 ),
IF ( ( MOD ( CRITERIA -> LOCATIONS -> ROOM_CNT , 10 )=1 ) )  STAT = ALTERLIST ( CRITERIA ->
 LOCATIONS -> ROOMS , ( CRITERIA -> LOCATIONS -> ROOM_CNT +9 ))
ENDIF
, CRITERIA -> LOCATIONS -> ROOMS [ CRITERIA -> LOCATIONS -> ROOM_CNT ]-> ROOM_CD =LG.PARENT_LOC_CD
 WITH  NOCOUNTER
IF ( ( ROOMADDITIONS >0 ) )
SET  ROOMADDITIONS  = (( CRITERIA -> LOCATIONS -> ROOM_CNT - ROOMADDITIONS )+1 )
SELECT  INTO "nl:"
FROM ( LOCATION_GROUP  LG )
 PLAN ( LG
WHERE  EXPAND ( LOCX ,  ROOMADDITIONS ,  CRITERIA -> LOCATIONS -> ROOM_CNT , LG.CHILD_LOC_CD,
 CRITERIA -> LOCATIONS -> ROOMS [ LOCX ]-> ROOM_CD ) AND  NOT ( EXPAND ( LOCY , 1 ,  CRITERIA ->
 LOCATIONS -> UNIT_CNT , LG.PARENT_LOC_CD,  CRITERIA -> LOCATIONS -> UNITS [ LOCY ]-> UNIT_CD ) )
 AND ((LG.ROOT_LOC_CD+0 )=0.0 ) AND (LG.ACTIVE_IND=1 ) AND (LG.END_EFFECTIVE_DT_TM>= CNVTDATETIME (
 CURDATE ,  CURTIME3 )))
 
ORDER BY LG.PARENT_LOC_CD
 
HEAD LG.PARENT_LOC_CD
 CRITERIA -> LOCATIONS -> UNIT_CNT =( CRITERIA -> LOCATIONS -> UNIT_CNT +1 ),
IF ( ( MOD ( CRITERIA -> LOCATIONS -> UNIT_CNT , 10 )=1 ) )  STAT = ALTERLIST ( CRITERIA ->
 LOCATIONS -> UNITS , ( CRITERIA -> LOCATIONS -> UNIT_CNT +9 ))
ENDIF
, CRITERIA -> LOCATIONS -> UNITS [ CRITERIA -> LOCATIONS -> UNIT_CNT ]-> UNIT_CD =LG.PARENT_LOC_CD
 WITH  NOCOUNTER
ENDIF
 
ENDIF
 
IF ( ( ROOMCNT >0 ) )
SELECT  INTO "nl:"
FROM ( LOCATION_GROUP  LG )
 
WHERE  EXPAND ( LOCX , 1 ,  ROOMCNT , LG.CHILD_LOC_CD,  CRITERIA -> LOCATIONS -> ROOMS [ LOCX ]->
 ROOM_CD ) AND  NOT ( EXPAND ( LOCY , 1 ,  CRITERIA -> LOCATIONS -> UNIT_CNT , LG.PARENT_LOC_CD,
 CRITERIA -> LOCATIONS -> UNITS [ LOCY ]-> UNIT_CD ) ) AND ((LG.ROOT_LOC_CD+0 )=0.0 ) AND (
LG.ACTIVE_IND=1 ) AND (LG.END_EFFECTIVE_DT_TM>= CNVTDATETIME ( CURDATE ,  CURTIME3 ))
ORDER BY LG.PARENT_LOC_CD
 
HEAD LG.PARENT_LOC_CD
 CRITERIA -> LOCATIONS -> UNIT_CNT =( CRITERIA -> LOCATIONS -> UNIT_CNT +1 ),
IF ( ( MOD ( CRITERIA -> LOCATIONS -> UNIT_CNT , 10 )=1 ) )  STAT = ALTERLIST ( CRITERIA ->
 LOCATIONS -> UNITS , ( CRITERIA -> LOCATIONS -> UNIT_CNT +9 ))
ENDIF
, CRITERIA -> LOCATIONS -> UNITS [ CRITERIA -> LOCATIONS -> UNIT_CNT ]-> UNIT_CD =LG.PARENT_LOC_CD
 WITH  NOCOUNTER
ENDIF
 
ENDIF
 
 
END ;Subroutine
 
 
SUBROUTINE   POPULATESCHEDULELOCATIONS  ( X  )
 
DECLARE  FACLEVEL  =  I2  WITH  NOCONSTANT (0 )
DECLARE  BLDGLEVEL  =  I2  WITH  NOCONSTANT (0 )
DECLARE  NULEVEL  =  I2  WITH  NOCONSTANT (0 )
SELECT  INTO "nl:"
FROM ( SCH_CODE_GROUP  S )
 PLAN ( S
WHERE (S.CODE_GROUP_ID=1 ))
 
 
DETAIL
 
IF ( (S.CDF_MEANING="FACILITY" ) )  FACLEVEL =1
ELSEIF ( (S.CDF_MEANING="BUILDING" ) )  BLDGLEVEL =1
ELSEIF (  (( (S.CDF_MEANING="NURSEUNIT" ) )  OR  ( (( (S.CDF_MEANING="ANCILSURG" ) )  OR  ((
S.CDF_MEANING="AMBULATORY" ) ))  ))  )  NULEVEL =1
ENDIF
 
 WITH  NOCOUNTER
IF ( ( CRITERIA -> LOCATIONS -> FACILITY_CNT >0 ) )
FOR (  X  = 1  TO  CRITERIA -> LOCATIONS -> FACILITY_CNT  )
 
SET  CRITERIA -> SCHEDULE_LOCATION_CNT  = ( CRITERIA -> SCHEDULE_LOCATION_CNT +1 )
IF ( ( MOD ( CRITERIA -> SCHEDULE_LOCATION_CNT , 10 )=1 ) )
SET  STAT  =  ALTERLIST ( CRITERIA -> SCHEDULE_LOCATIONS , ( CRITERIA -> SCHEDULE_LOCATION_CNT +9 ))
ENDIF
 
SET  CRITERIA -> SCHEDULE_LOCATIONS [ CRITERIA -> SCHEDULE_LOCATION_CNT ]-> LOC_CD  =  CRITERIA ->
 LOCATIONS -> FACILITIES [ X ]-> FACILITY_CD
 
ENDFOR
 
IF (  (( ( BLDGLEVEL =1 ) )  OR  (( NULEVEL =1 ) ))  )
SELECT  INTO "nl:"
FROM ( LOCATION_GROUP  LG )
 PLAN ( LG
WHERE  EXPAND ( LOCX , 1 ,  CRITERIA -> LOCATIONS -> FACILITY_CNT , LG.PARENT_LOC_CD,  CRITERIA ->
 LOCATIONS -> FACILITIES [ LOCX ]-> FACILITY_CD ) AND ((LG.ROOT_LOC_CD+0 )=0.0 ) AND (LG.ACTIVE_IND=
1 ) AND (LG.END_EFFECTIVE_DT_TM>= CNVTDATETIME ( CURDATE ,  CURTIME3 )) AND  NOT ( EXPAND ( LOCY ,
1 ,  CRITERIA -> LOCATIONS -> BUILDING_CNT , LG.CHILD_LOC_CD,  CRITERIA -> LOCATIONS -> BUILDINGS [
 LOCY ]-> BUILDING_CD ) ))
 
ORDER BY LG.CHILD_LOC_CD
 
HEAD LG.CHILD_LOC_CD
 CRITERIA -> LOCATIONS -> BUILDING_CNT =( CRITERIA -> LOCATIONS -> BUILDING_CNT +1 ),
IF ( ( MOD ( CRITERIA -> LOCATIONS -> BUILDING_CNT , 10 )=1 ) )  STAT = ALTERLIST ( CRITERIA ->
 LOCATIONS -> BUILDINGS , ( CRITERIA -> LOCATIONS -> BUILDING_CNT +9 ))
ENDIF
, CRITERIA -> LOCATIONS -> BUILDINGS [ CRITERIA -> LOCATIONS -> BUILDING_CNT ]-> BUILDING_CD =
LG.CHILD_LOC_CD
 WITH  NOCOUNTER
ENDIF
 
ENDIF
 
IF ( ( CRITERIA -> LOCATIONS -> BUILDING_CNT >0 ) )
FOR (  X  = 1  TO  CRITERIA -> LOCATIONS -> BUILDING_CNT  )
 
SET  CRITERIA -> SCHEDULE_LOCATION_CNT  = ( CRITERIA -> SCHEDULE_LOCATION_CNT +1 )
IF ( ( MOD ( CRITERIA -> SCHEDULE_LOCATION_CNT , 10 )=1 ) )
SET  STAT  =  ALTERLIST ( CRITERIA -> SCHEDULE_LOCATIONS , ( CRITERIA -> SCHEDULE_LOCATION_CNT +9 ))
ENDIF
 
SET  CRITERIA -> SCHEDULE_LOCATIONS [ CRITERIA -> SCHEDULE_LOCATION_CNT ]-> LOC_CD  =  CRITERIA ->
 LOCATIONS -> BUILDINGS [ X ]-> BUILDING_CD
 
ENDFOR
 
IF ( ( NULEVEL =1 ) )
SELECT  INTO "nl:"
FROM ( LOCATION_GROUP  LG )
 
WHERE  EXPAND ( LOCX , 1 ,  CRITERIA -> LOCATIONS -> BUILDING_CNT , LG.PARENT_LOC_CD,  CRITERIA ->
 LOCATIONS -> BUILDINGS [ LOCX ]-> BUILDING_CD ) AND ((LG.ROOT_LOC_CD+0 )=0.0 ) AND (LG.ACTIVE_IND=
1 ) AND (LG.END_EFFECTIVE_DT_TM>= CNVTDATETIME ( CURDATE ,  CURTIME3 )) AND  NOT ( EXPAND ( LOCY ,
1 ,  CRITERIA -> LOCATIONS -> UNIT_CNT , LG.CHILD_LOC_CD,  CRITERIA -> LOCATIONS -> UNITS [ LOCY ]->
 UNIT_CD ) )
ORDER BY LG.CHILD_LOC_CD
 
HEAD LG.CHILD_LOC_CD
 CRITERIA -> LOCATIONS -> UNIT_CNT =( CRITERIA -> LOCATIONS -> UNIT_CNT +1 ),
IF ( ( MOD ( CRITERIA -> LOCATIONS -> UNIT_CNT , 10 )=1 ) )  STAT = ALTERLIST ( CRITERIA ->
 LOCATIONS -> UNITS , ( CRITERIA -> LOCATIONS -> UNIT_CNT +9 ))
ENDIF
, CRITERIA -> LOCATIONS -> UNITS [ CRITERIA -> LOCATIONS -> UNIT_CNT ]-> UNIT_CD =LG.CHILD_LOC_CD
 WITH  NOCOUNTER
ENDIF
 
ENDIF
 
IF ( ( CRITERIA -> LOCATIONS -> UNIT_CNT >0 ) )
FOR (  X  = 1  TO  CRITERIA -> LOCATIONS -> UNIT_CNT  )
 
SET  CRITERIA -> SCHEDULE_LOCATION_CNT  = ( CRITERIA -> SCHEDULE_LOCATION_CNT +1 )
IF ( ( MOD ( CRITERIA -> SCHEDULE_LOCATION_CNT , 10 )=1 ) )
SET  STAT  =  ALTERLIST ( CRITERIA -> SCHEDULE_LOCATIONS , ( CRITERIA -> SCHEDULE_LOCATION_CNT +9 ))
ENDIF
 
SET  CRITERIA -> SCHEDULE_LOCATIONS [ CRITERIA -> SCHEDULE_LOCATION_CNT ]-> LOC_CD  =  CRITERIA ->
 LOCATIONS -> UNITS [ X ]-> UNIT_CD
 
ENDFOR
 
ENDIF
 
 
END ;Subroutine
 
 
SUBROUTINE   ADDSERVICE  ( SERVICECD  )
 
SET  CRITERIA -> SERVICE_CNT  = ( CRITERIA -> SERVICE_CNT +1 )
SET  STAT  =  ALTERLIST ( CRITERIA -> SERVICES ,  CRITERIA -> SERVICE_CNT )
SET  CRITERIA -> SERVICES [ CRITERIA -> SERVICE_CNT ]-> SERVICE_CD  =  SERVICECD
 
END ;Subroutine
 
 
SUBROUTINE   ADDENCNTRTYPE  ( TYPECD  )
 
SET  CRITERIA -> TYPE_CNT  = ( CRITERIA -> TYPE_CNT +1 )
SET  STAT  =  ALTERLIST ( CRITERIA -> TYPES ,  CRITERIA -> TYPE_CNT )
SET  CRITERIA -> TYPES [ CRITERIA -> TYPE_CNT ]-> ENCNTR_TYPE_CD  =  TYPECD
 
END ;Subroutine
 
 
SUBROUTINE   ADDENCNTRCLASS  ( CLASSCD  )
 
SET  CRITERIA -> CLASS_CNT  = ( CRITERIA -> CLASS_CNT +1 )
SET  STAT  =  ALTERLIST ( CRITERIA -> CLASSES ,  CRITERIA -> CLASS_CNT )
SET  CRITERIA -> CLASSES [ CRITERIA -> CLASS_CNT ]-> ENCNTR_CLASS_CD  =  CLASSCD
 
END ;Subroutine
 
 
SUBROUTINE   ADDENCNTRSTATUS  ( STATUSCD  )
 
SET  CRITERIA -> STATUS_CNT  = ( CRITERIA -> STATUS_CNT +1 )
SET  STAT  =  ALTERLIST ( CRITERIA -> STATUSES ,  CRITERIA -> STATUS_CNT )
SET  CRITERIA -> STATUSES [ CRITERIA -> STATUS_CNT ]-> ENCNTR_STATUS_CD  =  STATUSCD
 
END ;Subroutine
 
 
SUBROUTINE   ADDRELTN  ( RELTNCD  )
 
DECLARE  RELTNTYPE  =  I2  WITH  NOCONSTANT (0 ), PROTECTED
SELECT  INTO "nl:"
FROM ( CODE_VALUE  CV )
 PLAN ( CV
WHERE (CV.CODE_VALUE= RELTNCD ))
 
 
DETAIL
 
IF ( (CV.CODE_SET=333 ) )  RELTNTYPE =1
ELSEIF ( (CV.CODE_SET=331 ) )  RELTNTYPE =2
ENDIF
 
 WITH  NOCOUNTER
IF ( ( RELTNTYPE =1 ) )
 CALL ADDVISITRELTN ( RELTNCD )
ELSEIF ( ( RELTNTYPE =2 ) )
 CALL ADDLIFETIMERELTN ( RELTNCD )
ENDIF
 
 
END ;Subroutine
 
 
SUBROUTINE   ADDVISITRELTN  ( RELTNCD  )
 
IF ( ( RELTNCD =0.0 ) )
SET  CRITERIA -> VRELTN_CNT  =  - (1 )
ELSEIF ( ( CRITERIA -> VRELTN_CNT >=0 ) )
SET  CRITERIA -> VRELTN_CNT  = ( CRITERIA -> VRELTN_CNT +1 )
SET  STAT  =  ALTERLIST ( CRITERIA -> VRELTNS ,  CRITERIA -> VRELTN_CNT )
SET  CRITERIA -> VRELTNS [ CRITERIA -> VRELTN_CNT ]-> VRELTN_CD  =  RELTNCD
ENDIF
 
 
END ;Subroutine
 
 
SUBROUTINE   ADDLIFETIMERELTN  ( RELTNCD  )
 
IF ( ( RELTNCD =0.0 ) )
SET  CRITERIA -> LRELTN_CNT  =  - (1 )
ELSEIF ( ( CRITERIA -> LRELTN_CNT >=0 ) )
SET  CRITERIA -> LRELTN_CNT  = ( CRITERIA -> LRELTN_CNT +1 )
SET  STAT  =  ALTERLIST ( CRITERIA -> LRELTNS ,  CRITERIA -> LRELTN_CNT )
SET  CRITERIA -> LRELTNS [ CRITERIA -> LRELTN_CNT ]-> LRELTN_CD  =  RELTNCD
ENDIF
 
 
END ;Subroutine
 
 
SUBROUTINE   ADDPRSNLGROUP  ( GROUPID  )
 
DECLARE  PRSNLGROUPLISTTYPE  =  VC  WITH  CONSTANT ( UAR_GET_CODE_MEANING ( ptlst_request ->
 PATIENT_LIST_TYPE_CD )), PRIVATE
IF ( ( PRSNLGROUPLISTTYPE ="PROVIDERGRP" ) )
 CALL ADDPROVIDERGROUP ( GROUPID )
ELSE
 CALL ADDCARETEAM ( GROUPID )
ENDIF
 
 
END ;Subroutine
 
 
SUBROUTINE   ADDPROVIDERGROUP  ( GROUPID  )
 
SET  CRITERIA -> PROVIDER_GRP_CNT  = ( CRITERIA -> PROVIDER_GRP_CNT +1 )
SET  STAT  =  ALTERLIST ( CRITERIA -> PROVIDER_GRPS ,  CRITERIA -> PROVIDER_GRP_CNT )
SET  CRITERIA -> PROVIDER_GRPS [ CRITERIA -> PROVIDER_GRP_CNT ]-> GROUP_ID  =  GROUPID
 
END ;Subroutine
 
 
SUBROUTINE   ADDCARETEAM  ( GROUPID  )
 
SET  CRITERIA -> CARETEAM_CNT  = ( CRITERIA -> CARETEAM_CNT +1 )
SET  STAT  =  ALTERLIST ( CRITERIA -> CARETEAMS ,  CRITERIA -> CARETEAM_CNT )
SET  CRITERIA -> CARETEAMS [ CRITERIA -> CARETEAM_CNT ]-> GROUP_ID  =  GROUPID
 
END ;Subroutine
 
 
SUBROUTINE   SETLAGMINUTES  ( MINS  )
 
DECLARE  INTERVAL  =  VC  WITH  NOCONSTANT ( FILLSTRING (25 , " " )), PRIVATE
SET  INTERVAL  =  BUILD ( ABS ( MINS ), "min" )
SET  CRITERIA -> END_EFFECTIVE_DT_TM  =  CNVTLOOKBEHIND ( INTERVAL ,  CNVTDATETIME ( CURDATE ,
 CURTIME3 ))
SET  CRITERIA -> TIME_FRAME_FLAG  =  LAGTIMEPARAMETER
 
END ;Subroutine
 
 
SUBROUTINE   SETRECENTMINUTES  ( MINS  )
 
DECLARE  INTERVAL  =  VC  WITH  NOCONSTANT ( FILLSTRING (25 , " " )), PRIVATE
SET  INTERVAL  =  BUILD ( ABS ( MINS ), "min" )
SET  CRITERIA -> BEG_EFFECTIVE_DT_TM  =  CNVTLOOKBEHIND ( INTERVAL ,  CNVTDATETIME ( CURDATE ,
 CURTIME3 ))
SET  CRITERIA -> TIME_FRAME_FLAG  =  RECENTTIMEPARAMETER
 
END ;Subroutine
 
 
SUBROUTINE   SETADMITMINUTES  ( MINS  )
 
DECLARE  INTERVAL  =  VC  WITH  NOCONSTANT ( FILLSTRING (25 , " " )), PRIVATE
SET  INTERVAL  =  BUILD ( ABS ( MINS ), "min" )
SET  CRITERIA -> ADMIT_DT_TM  =  CNVTLOOKBEHIND ( INTERVAL ,  CNVTDATETIME ( CURDATE ,  CURTIME3 ))
SET  CRITERIA -> ADMIT_FLAG  = 1
 
END ;Subroutine
 
 
SUBROUTINE   SETLOOKFORWARDADMITMINUTES  ( MINS  )
 
DECLARE  INTERVAL  =  VC  WITH  NOCONSTANT ( FILLSTRING (25 , " " )), PRIVATE
SET  INTERVAL  =  BUILD ( ABS ( MINS ), "min" )
SET  CRITERIA -> LOOKFORWARD_ADMIT_DT_TM  =  CNVTLOOKAHEAD ( INTERVAL ,  CNVTDATETIME ( CURDATE ,
 CURTIME3 ))
SET  CRITERIA -> LOOKFORWARD_ADMIT_FLAG  = 1
 
END ;Subroutine
 
 
SUBROUTINE   SETDISCHARGEMINUTES  ( MINS  )
 
DECLARE  INTERVAL  =  VC  WITH  NOCONSTANT ( FILLSTRING (25 , " " )), PRIVATE
IF ( ( MINS <0 ) )
SET  CRITERIA -> DISCHARGE_FLAG  = 2
ELSEIF ( ( MINS >0 ) )
SET  INTERVAL  =  BUILD ( ABS ( MINS ), "min" )
SET  CRITERIA -> DISCH_DT_TM  =  CNVTLOOKBEHIND ( INTERVAL ,  CNVTDATETIME ( CURDATE ,  CURTIME3 ))
SET  CRITERIA -> DISCHARGE_FLAG  = 1
ENDIF
 
 
END ;Subroutine
 
 
SUBROUTINE   SETBEGINDT  ( VALUE  )
 
DECLARE  INDEX  =  I4  WITH  NOCONSTANT (0 ), PRIVATE
DECLARE  LEN  =  I4  WITH  NOCONSTANT (0 ), PRIVATE
DECLARE  SRCTZ  =  I2  WITH  NOCONSTANT (0 ), PRIVATE
DECLARE  DTSTRING  =  VC  WITH  NOCONSTANT ( FILLSTRING (8 , " " )), PRIVATE
DECLARE  TMSTRING  =  VC  WITH  NOCONSTANT ( FILLSTRING (8 , " " )), PRIVATE
SET  INDEX  =  FINDSTRING (";" ,  VALUE )
SET  LEN  =  TEXTLEN ( VALUE )
SET  DTSTRING  =  SUBSTRING (1 , ( INDEX -1 ),  VALUE )
SET  SRCTZ  =  CNVTINT ( SUBSTRING (( INDEX +1 ), ( LEN - INDEX ),  VALUE ))
SET  NEWDT  =  CNVTDATETIME ( CNVTDATE2 ( DTSTRING , "YYYYMMDD" ), 0 )
SET  CRITERIA -> BEG_EFFECTIVE_DT_TM  =  DATETIMEZONE ( NEWDT ,  SRCTZ , 2 )
SET  CRITERIA -> BEGIN_TZ  =  SRCTZ
SET  CRITERIA -> TIME_FRAME_FLAG  =  TIMERANGEPARAMETER
 
END ;Subroutine
 
 
SUBROUTINE   SETENDDT  ( VALUE  )
 
DECLARE  INDEX  =  I4  WITH  NOCONSTANT (0 ), PRIVATE
DECLARE  LEN  =  I4  WITH  NOCONSTANT (0 ), PRIVATE
DECLARE  SRCTZ  =  I2  WITH  NOCONSTANT (0 ), PRIVATE
DECLARE  DTSTRING  =  VC  WITH  NOCONSTANT ( FILLSTRING (8 , " " )), PRIVATE
DECLARE  TMSTRING  =  VC  WITH  NOCONSTANT ( FILLSTRING (8 , " " )), PRIVATE
SET  INDEX  =  FINDSTRING (";" ,  VALUE )
SET  LEN  =  TEXTLEN ( VALUE )
SET  DTSTRING  =  SUBSTRING (1 , ( INDEX -1 ),  VALUE )
SET  SRCTZ  =  CNVTINT ( SUBSTRING (( INDEX +1 ), ( LEN - INDEX ),  VALUE ))
SET  NEWDT  =  CNVTDATETIME ( CNVTDATE2 ( DTSTRING , "YYYYMMDD" ), 0 )
SET  CRITERIA -> END_EFFECTIVE_DT_TM  =  DATETIMEZONE ( NEWDT ,  SRCTZ , 2 )
SET  CRITERIA -> END_TZ  =  SRCTZ
SET  CRITERIA -> TIME_FRAME_FLAG  =  TIMERANGEPARAMETER
 
END ;Subroutine
 
 
SUBROUTINE   SETBEGINTM  ( VALUE  )
 
DECLARE  INDEX  =  I4  WITH  NOCONSTANT (0 ), PRIVATE
DECLARE  LEN  =  I4  WITH  NOCONSTANT (0 ), PRIVATE
DECLARE  SRCTZ  =  I2  WITH  NOCONSTANT (0 ), PRIVATE
DECLARE  DTSTRING  =  VC  WITH  NOCONSTANT ( FILLSTRING (8 , " " )), PRIVATE
DECLARE  TMSTRING  =  VC  WITH  NOCONSTANT ( FILLSTRING (8 , " " )), PRIVATE
DECLARE  TMSTRING2  =  VC  WITH  NOCONSTANT ( FILLSTRING (8 , " " )), PRIVATE
DECLARE  IND  =  I2  WITH  NOCONSTANT (0 )
DECLARE  INTERVAL  =  VC  WITH  NOCONSTANT ( FILLSTRING (25 , " " )), PRIVATE
SET  INDEX  =  FINDSTRING (";" ,  VALUE )
SET  LEN  =  TEXTLEN ( VALUE )
SET  TMSTRING2  =  SUBSTRING (1 , ( INDEX -1 ),  VALUE )
SET  TMSTRING  =  SUBSTRING (9 , 6 ,  TMSTRING2 )
SET  SRCTZ  =  CNVTINT ( SUBSTRING (( INDEX +1 ), ( LEN - INDEX ),  VALUE ))
SET  NOW  =  CNVTDATETIME ( CURDATE ,  CNVTINT ( TMSTRING ))
SET  CRITERIA -> BEG_EFFECTIVE_DT_TM  =  DATETIMEZONE ( NOW ,  SRCTZ , 2 )
SET  CRITERIA -> BEGIN_TZ  =  SRCTZ
IF ( ( TIMEDIFFSET =1 ) )
 CALL DETERMINEDTTMSHIFT (1 )
ENDIF
 
SET  TIMEDIFFSET  = 1
SET  CRITERIA -> TIME_FRAME_FLAG  =  TIMERANGEPARAMETER
 
END ;Subroutine
 
 
SUBROUTINE   SETENDTM  ( VALUE  )
 
DECLARE  INDEX  =  I4  WITH  NOCONSTANT (0 ), PRIVATE
DECLARE  LEN  =  I4  WITH  NOCONSTANT (0 ), PRIVATE
DECLARE  SRCTZ  =  I2  WITH  NOCONSTANT (0 ), PRIVATE
DECLARE  DTSTRING  =  VC  WITH  NOCONSTANT ( FILLSTRING (8 , " " )), PRIVATE
DECLARE  TMSTRING  =  VC  WITH  NOCONSTANT ( FILLSTRING (8 , " " )), PRIVATE
DECLARE  TMSTRING2  =  VC  WITH  NOCONSTANT ( FILLSTRING (8 , " " )), PRIVATE
DECLARE  IND  =  I2  WITH  NOCONSTANT (0 )
SET  INDEX  =  FINDSTRING (";" ,  VALUE )
SET  LEN  =  TEXTLEN ( VALUE )
SET  TMSTRING2  =  SUBSTRING (1 , ( INDEX -1 ),  VALUE )
SET  TMSTRING  =  SUBSTRING (9 , 6 ,  TMSTRING2 )
SET  SRCTZ  =  CNVTINT ( SUBSTRING (( INDEX +1 ), ( LEN - INDEX ),  VALUE ))
SET  NOW  =  CNVTDATETIME ( CURDATE ,  CNVTINT ( TMSTRING ))
SET  CRITERIA -> END_EFFECTIVE_DT_TM  =  DATETIMEZONE ( NOW ,  SRCTZ , 2 )
SET  CRITERIA -> END_TZ  =  SRCTZ
IF ( ( TIMEDIFFSET =1 ) )
 CALL DETERMINEDTTMSHIFT (1 )
ENDIF
 
SET  TIMEDIFFSET  = 1
SET  CRITERIA -> TIME_FRAME_FLAG  =  TIMERANGEPARAMETER
 
END ;Subroutine
 
 
SUBROUTINE   DETERMINEDTTMSHIFT  ( X  )
 
IF ( ( CRITERIA -> BEG_EFFECTIVE_DT_TM > CRITERIA -> END_EFFECTIVE_DT_TM ) )
IF ( ( CNVTDATETIME ( CURDATE ,  CURTIME )< CNVTDATETIME ( CURDATE , 0 )) AND ( CNVTDATETIME (
 CURDATE ,  CURTIME )> CNVTDATETIME ( CRITERIA -> BEG_EFFECTIVE_DT_TM )) )
SET  DT  =  CNVTLOOKAHEAD ("1,D" ,  CRITERIA -> END_EFFECTIVE_DT_TM )
SET  CRITERIA -> END_EFFECTIVE_DT_TM  =  DT
ELSEIF ( ( CNVTDATETIME ( CURDATE ,  CURTIME )> CNVTDATETIME ( CURDATE , 0 )) AND ( CNVTDATETIME (
 CURDATE ,  CURTIME )< CNVTDATETIME ( CRITERIA -> END_EFFECTIVE_DT_TM )) )
SET  DT  =  CNVTLOOKBEHIND ("1,D" ,  CRITERIA -> BEG_EFFECTIVE_DT_TM )
SET  CRITERIA -> BEG_EFFECTIVE_DT_TM  =  DT
ELSE
SET  DT1  =  DATETIMEDIFF ( CRITERIA -> BEG_EFFECTIVE_DT_TM ,  CNVTDATETIME ( CURDATE ,  CURTIME ))
SET  DT2  =  DATETIMEDIFF ( CNVTDATETIME ( CURDATE ,  CURTIME ),  CRITERIA -> END_EFFECTIVE_DT_TM )
IF ( ( DT1 < DT2 ) )
SET  DT  =  CNVTLOOKAHEAD ("1,D" ,  CRITERIA -> END_EFFECTIVE_DT_TM )
SET  CRITERIA -> END_EFFECTIVE_DT_TM  =  DT
ELSE
SET  DT  =  CNVTLOOKBEHIND ("1,D" ,  CRITERIA -> BEG_EFFECTIVE_DT_TM )
SET  CRITERIA -> BEG_EFFECTIVE_DT_TM  =  DT
ENDIF
 
ENDIF
 
ENDIF
 
 
END ;Subroutine
 
 
SUBROUTINE   SETBEGINDTTM  ( VALUE  )
 
DECLARE  INDEX  =  I4  WITH  NOCONSTANT (0 ), PRIVATE
DECLARE  LEN  =  I4  WITH  NOCONSTANT (0 ), PRIVATE
DECLARE  SRCTZ  =  I2  WITH  NOCONSTANT (0 ), PRIVATE
DECLARE  DTSTRING  =  VC  WITH  NOCONSTANT ( FILLSTRING (8 , " " )), PRIVATE
DECLARE  TMSTRING  =  VC  WITH  NOCONSTANT ( FILLSTRING (8 , " " )), PRIVATE
SET  INDEX  =  FINDSTRING (";" ,  VALUE )
SET  LEN  =  TEXTLEN ( VALUE )
SET  DTSTRING  =  SUBSTRING (1 , ( INDEX -1 ),  VALUE )
SET  SRCTZ  =  CNVTINT ( SUBSTRING (( INDEX +1 ), ( LEN - INDEX ),  VALUE ))
 CALL ECHO ( VALUE )
 CALL ECHO ( DTSTRING )
SET  NEWDT  =  CNVTDATETIME ( CNVTDATE2 ( DTSTRING , "YYYYMMDD" ), 0 )
 CALL ECHO ( NEWDT )
SET  CRITERIA -> BEG_EFFECTIVE_DT_TM  =  DATETIMEZONE ( NEWDT ,  SRCTZ , 2 )
SET  CRITERIA -> BEGIN_TZ  =  SRCTZ
 CALL ECHO ( CRITERIA -> BEG_EFFECTIVE_DT_TM )
SET  CRITERIA -> TIME_FRAME_FLAG  =  TIMERANGEPARAMETER
 
END ;Subroutine
 
 
SUBROUTINE   SETENDDTTM  ( VALUE  )
 
DECLARE  INDEX  =  I4  WITH  NOCONSTANT (0 ), PRIVATE
DECLARE  LEN  =  I4  WITH  NOCONSTANT (0 ), PRIVATE
DECLARE  SRCTZ  =  I2  WITH  NOCONSTANT (0 ), PRIVATE
DECLARE  DTSTRING  =  VC  WITH  NOCONSTANT ( FILLSTRING (8 , " " )), PRIVATE
DECLARE  TMSTRING  =  VC  WITH  NOCONSTANT ( FILLSTRING (8 , " " )), PRIVATE
SET  INDEX  =  FINDSTRING (";" ,  VALUE )
SET  LEN  =  TEXTLEN ( VALUE )
SET  DTSTRING  =  SUBSTRING (1 , ( INDEX -1 ),  VALUE )
SET  SRCTZ  =  CNVTINT ( SUBSTRING (( INDEX +1 ), ( LEN - INDEX ),  VALUE ))
SET  NEWDT  =  CNVTDATETIME ( CNVTDATE2 ( DTSTRING , "YYYYMMDD" ), 235959 )
SET  CRITERIA -> END_EFFECTIVE_DT_TM  =  DATETIMEZONE ( NEWDT ,  SRCTZ , 2 )
SET  CRITERIA -> END_TZ  =  SRCTZ
SET  CRITERIA -> TIME_FRAME_FLAG  =  TIMERANGEPARAMETER
 
END ;Subroutine
 
 
SUBROUTINE   PARSEFILTERS  ( X  )
 
DECLARE  FILTER_NBR  =  I4  WITH  NOCONSTANT ( CNVTINT ( SIZE ( ptlst_request -> ENCNTR_TYPE_FILTERS , 5 )
))
DECLARE  COUNTER  =  I4  WITH  NOCONSTANT (1 ), PRIVATE
FOR (  COUNTER  = 1  TO  FILTER_NBR  )
 
IF ( ( ptlst_request -> ENCNTR_TYPE_FILTERS [ COUNTER ]-> ENCNTR_CLASS_CD >0 ) )
 CALL ADDENCNTRCLASS ( ptlst_request -> ENCNTR_TYPE_FILTERS [ COUNTER ]-> ENCNTR_CLASS_CD )
ELSEIF ( ( ptlst_request -> ENCNTR_TYPE_FILTERS [ COUNTER ]-> ENCNTR_TYPE_CD >0 ) )
 CALL ADDENCNTRTYPE ( ptlst_request -> ENCNTR_TYPE_FILTERS [ COUNTER ]-> ENCNTR_TYPE_CD )
ENDIF
 
 
ENDFOR
 
 
END ;Subroutine
 
 
SUBROUTINE   PARSEARGUMENTS  ( X  )
 
DECLARE  ARG_NBR  =  I4  WITH  NOCONSTANT ( CNVTINT ( SIZE ( ptlst_request -> ARGUMENTS , 5 ))), PRIVATE
DECLARE  COUNTER  =  I4  WITH  NOCONSTANT (1 ), PRIVATE
DECLARE  PATIENT_STATUS_FLAG  =  I4  WITH  NOCONSTANT (0 ), PRIVATE
DECLARE  PATIENT_STATUS_MINUTES  =  I4  WITH  NOCONSTANT (0 ), PRIVATE
DECLARE  LISTTYPEMEANING  =  VC  WITH  CONSTANT ( UAR_GET_CODE_MEANING ( ptlst_request ->
 PATIENT_LIST_TYPE_CD )), PRIVATE
FOR (  COUNTER  = 1  TO  ARG_NBR  )
 
CASE (  ptlst_request -> ARGUMENTS [ COUNTER ]-> ARGUMENT_NAME  )
 OF "facility_filter" :
 CALL ADDLOCATION ( ptlst_request -> ARGUMENTS [ COUNTER ]-> PARENT_ENTITY_ID )
 OF "location_group" :
 CALL ADDLOCATION ( ptlst_request -> ARGUMENTS [ COUNTER ]-> PARENT_ENTITY_ID )
 OF "location" :
 CALL ADDLOCATION ( ptlst_request -> ARGUMENTS [ COUNTER ]-> PARENT_ENTITY_ID )
 OF "resource" :
 CALL ADDRESOURCE ( ptlst_request -> ARGUMENTS [ COUNTER ]-> PARENT_ENTITY_ID )
 OF "medical_service_cd" :
 CALL ADDSERVICE ( ptlst_request -> ARGUMENTS [ COUNTER ]-> PARENT_ENTITY_ID )
 OF "encntr_type" :
 CALL ADDENCNTRTYPE ( ptlst_request -> ARGUMENTS [ COUNTER ]-> PARENT_ENTITY_ID )
 OF "encntr_class" :
 CALL ADDENCNTRCLASS ( ptlst_request -> ARGUMENTS [ COUNTER ]-> PARENT_ENTITY_ID )
 OF "encntr_status" :
 CALL ADDENCNTRSTATUS ( ptlst_request -> ARGUMENTS [ COUNTER ]-> PARENT_ENTITY_ID )
 OF "reltn_cd" :
 CALL ADDRELTN ( ptlst_request -> ARGUMENTS [ COUNTER ]-> PARENT_ENTITY_ID )
 OF "visit_reltn_cd" :
 CALL ADDVISITRELTN ( ptlst_request -> ARGUMENTS [ COUNTER ]-> PARENT_ENTITY_ID )
 OF "lifetime_reltn_cd" :
 CALL ADDLIFETIMERELTN ( ptlst_request -> ARGUMENTS [ COUNTER ]-> PARENT_ENTITY_ID )
 OF "prsnl_id" :
SET  CRITERIA -> RELTN_PRSNL_ID  =  ptlst_request -> ARGUMENTS [ COUNTER ]-> PARENT_ENTITY_ID
 OF "careteam_id" :
 CALL ADDCARETEAM ( ptlst_request -> ARGUMENTS [ COUNTER ]-> PARENT_ENTITY_ID )
 OF "provider_group_id" :
 CALL ADDPROVIDERGROUP ( ptlst_request -> ARGUMENTS [ COUNTER ]-> PARENT_ENTITY_ID )
 OF "prsnl_group_id" :
 CALL ADDPRSNLGROUP ( ptlst_request -> ARGUMENTS [ COUNTER ]-> PARENT_ENTITY_ID )
 OF "lag_minutes" :
 CALL SETLAGMINUTES ( CNVTINT ( ptlst_request -> ARGUMENTS [ COUNTER ]-> ARGUMENT_VALUE ))
 OF "recent_mins" :
 CALL SETRECENTMINUTES ( CNVTINT ( ptlst_request -> ARGUMENTS [ COUNTER ]-> ARGUMENT_VALUE ))
 OF "begin_dt" :
 CALL SETBEGINDT ( ptlst_request -> ARGUMENTS [ COUNTER ]-> ARGUMENT_VALUE )
 OF "end_dt" :
 CALL SETENDDT ( ptlst_request -> ARGUMENTS [ COUNTER ]-> ARGUMENT_VALUE )
 OF "begin_tm" :
 CALL SETBEGINTM ( ptlst_request -> ARGUMENTS [ COUNTER ]-> ARGUMENT_VALUE )
 OF "end_tm" :
 CALL SETENDTM ( ptlst_request -> ARGUMENTS [ COUNTER ]-> ARGUMENT_VALUE )
 OF "begin_dt_tm" :
 CALL SETBEGINDTTM ( ptlst_request -> ARGUMENTS [ COUNTER ]-> ARGUMENT_VALUE )
 OF "end_dt_tm" :
 CALL SETENDDTTM ( ptlst_request -> ARGUMENTS [ COUNTER ]-> ARGUMENT_VALUE )
 OF "admit_mins" :
 CALL SETADMITMINUTES ( CNVTINT ( ptlst_request -> ARGUMENTS [ COUNTER ]-> ARGUMENT_VALUE ))
 OF "lookforward_admit_mins" :
 CALL SETLOOKFORWARDADMITMINUTES ( CNVTINT ( ptlst_request -> ARGUMENTS [ COUNTER ]-> ARGUMENT_VALUE ))
 OF "disch_mins" :
 CALL SETDISCHARGEMINUTES ( CNVTINT ( ptlst_request -> ARGUMENTS [ COUNTER ]-> ARGUMENT_VALUE ))
 OF "discharged_only" :
 CALL SETDISCHARGEMINUTES (((120 *24 )*60 ))
 OF "best_encntr_flag" :
SET  CRITERIA -> BEST_ENCNTR_FLAG  = 1
 OF "patient_status_flag" :
SET  PATIENT_STATUS_FLAG  =  CNVTINT ( ptlst_request -> ARGUMENTS [ COUNTER ]-> ARGUMENT_VALUE )
 OF "patient_status_minutes" :
SET  PATIENT_STATUS_MINUTES  =  CNVTINT ( ptlst_request -> ARGUMENTS [ COUNTER ]-> ARGUMENT_VALUE )
 ENDCASE
 
 
ENDFOR
 
IF ( ( PATIENT_STATUS_FLAG =1 ) )
 CALL SETADMITMINUTES ( PATIENT_STATUS_MINUTES )
ELSEIF ( ( PATIENT_STATUS_FLAG =2 ) )
 CALL SETDISCHARGEMINUTES ( PATIENT_STATUS_MINUTES )
ELSEIF ( ( PATIENT_STATUS_FLAG =3 ) )
 CALL SETDISCHARGEMINUTES ( - (1 ))
ENDIF
 
IF ( ( CRITERIA -> DISCHARGE_FLAG =1 ) AND ( CRITERIA -> TIME_FRAME_FLAG = NOTIMEPARAMETER ) )
SET  CRITERIA -> END_EFFECTIVE_DT_TM  =  CRITERIA -> DISCH_DT_TM
ENDIF
 
 CALL PARSEFILTERS (1 )
IF ( ( LISTTYPEMEANING ="VRELTN" ) )
IF ( ( CRITERIA -> VRELTN_CNT =0 ) )
SET  CRITERIA -> VRELTN_CNT  =  - (1 )
ENDIF
 
ELSEIF ( ( LISTTYPEMEANING ="LRELTN" ) )
IF ( ( CRITERIA -> LRELTN_CNT =0 ) )
SET  CRITERIA -> LRELTN_CNT  =  - (1 )
ENDIF
 
ENDIF
 
 
END ;Subroutine
 
 
SUBROUTINE   STANDARDIZEENCNTRCLASSES  ( X  )
 
DECLARE  CLSX  =  I4  WITH  NOCONSTANT (0 )
IF ( ( CRITERIA -> CLASS_CNT >0 ) )
SELECT  INTO "nl:"
FROM ( CODE_VALUE_GROUP  CVG )
 PLAN ( CVG
WHERE  EXPAND ( CLSX , 1 ,  CRITERIA -> CLASS_CNT , CVG.PARENT_CODE_VALUE,  CRITERIA -> CLASSES [
 CLSX ]-> ENCNTR_CLASS_CD ))
 
ORDER BY CVG.CHILD_CODE_VALUE
 
HEAD CVG.CHILD_CODE_VALUE
 CRITERIA -> TYPE_CNT =( CRITERIA -> TYPE_CNT +1 ), STAT = ALTERLIST ( CRITERIA -> TYPES ,
 CRITERIA -> TYPE_CNT ), CRITERIA -> TYPES [ CRITERIA -> TYPE_CNT ]-> ENCNTR_TYPE_CD =
CVG.CHILD_CODE_VALUE
 WITH  NOCOUNTER
ENDIF
 
 
END ;Subroutine
 
 
SUBROUTINE   PERFORMORGSECURITY  ( X  )
 
DECLARE  B  =  I4  WITH  NOCONSTANT (0 )
DECLARE  ORG_CNT  =  I4  WITH  NOCONSTANT (0 )
DECLARE  TEMP_CNT  =  I4  WITH  NOCONSTANT (0 )
DECLARE  ORGID  =  F8  WITH  NOCONSTANT (0.0 )
FREE SET ORGS
RECORD  ORGS  (
1  TEMP [*]
2  ORG_ID  =  F8
1  QUAL [*]
2  ORG_ID  =  F8
2  CONFID_LEVEL  =  I4 )
SELECT  INTO "nl:"
FROM ( DUMMYT  D  WITH  SEQ = VALUE ( PATIENT_CNT ))
 PLAN ( D
WHERE ( ptlstEncntr_reply -> PATIENTS [D.SEQ]-> FILTER_IND =1 ))
 
ORDER BY  ptlstEncntr_reply -> PATIENTS [D.SEQ]-> ORGANIZATION_ID
 
HEAD REPORT
 ORGID =0.0 ,
 TEMP_CNT =0
DETAIL
 
IF ( ( ptlstEncntr_reply -> PATIENTS [D.SEQ]-> ORGANIZATION_ID != ORGID ) )  TEMP_CNT =( TEMP_CNT +1 ),
IF ( ( MOD ( TEMP_CNT , 10 )=1 ) )  STAT = ALTERLIST ( ORGS -> TEMP , ( TEMP_CNT +9 ))
ENDIF
,  ORGS -> TEMP [ TEMP_CNT ]-> ORG_ID = ptlstEncntr_reply -> PATIENTS [D.SEQ]-> ORGANIZATION_ID
ENDIF
 
 WITH  NOCOUNTER
IF ( ( TEMP_CNT >0 ) )
IF ( ( VALIDATE ( _SACRTL_ORG_INC_ , 99999 )=99999 ) )
DECLARE  _SACRTL_ORG_INC_  =  I2  WITH  CONSTANT (1 )
RECORD  SAC_ORG  (
1  ORGANIZATIONS [*]
2  ORGANIZATION_ID  =  F8
2  CONFID_CD  =  F8
2  CONFID_LEVEL  =  I4 )
 EXECUTE SECRTL
 EXECUTE SACRTL
DECLARE  ORGCNT  =  I4  WITH  PROTECTED , NOCONSTANT (0 )
DECLARE  SECSTAT  =  I2
DECLARE  LOGONTYPE  =  I4  WITH  PROTECT , NOCONSTANT ( - (1 ))
DECLARE  DYNAMIC_ORG_IND  =  I4  WITH  PROTECT , NOCONSTANT ( - (1 ))
DECLARE  DCUR_TRUSTID  =  F8  WITH  PROTECT , NOCONSTANT (0.0 )
DECLARE  DYNORG_ENABLED  =  I4  WITH  CONSTANT (1 )
DECLARE  DYNORG_DISABLED  =  I4  WITH  CONSTANT (0 )
DECLARE  LOGONTYPE_NHS  =  I4  WITH  CONSTANT (1 )
DECLARE  LOGONTYPE_LEGACY  =  I4  WITH  CONSTANT (0 )
 CALL UAR_SECGETCLIENTLOGONTYPE ( LOGONTYPE )
 CALL ECHO ( BUILD ("logontype:" ,  LOGONTYPE ))
IF ( ( LOGONTYPE != LOGONTYPE_NHS ) )
SET  DYNAMIC_ORG_IND  =  DYNORG_DISABLED
ENDIF
 
IF ( ( LOGONTYPE = LOGONTYPE_NHS ) )
DECLARE  GETDYNAMICORGPREF (( DTRUSTID = F8 )) =  I4
SUBROUTINE   GETDYNAMICORGPREF  ( DTRUSTID  )
 
DECLARE  SCUR_TRUST  =  VC
DECLARE  PREF_VAL  =  VC
DECLARE  IS_ENABLED  =  I4  WITH  CONSTANT (1 )
DECLARE  IS_DISABLED  =  I4  WITH  CONSTANT (0 )
SET  SCUR_TRUST  =  CNVTSTRING ( DTRUSTID )
SET  SCUR_TRUST  =  CONCAT ( SCUR_TRUST , ".00" )
IF (  NOT ( VALIDATE ( PREF_REQ , 0 ) ) )
RECORD  PREF_REQ  (
1  WRITE_IND  =  I2
1  DELETE_IND  =  I2
1  PREF [*]
2  CONTEXTS [*]
3  CONTEXT  =  VC
3  CONTEXT_ID  =  VC
2  SECTION  =  VC
2  SECTION_ID  =  VC
2  SUBGROUP  =  VC
2  ENTRIES [*]
3  ENTRY  =  VC
3  VALUES [*]
4  VALUE  =  VC )
ENDIF
 
IF (  NOT ( VALIDATE ( PREF_REP , 0 ) ) )
RECORD  PREF_REP  (
1  PREF [*]
2  SECTION  =  VC
2  SECTION_ID  =  VC
2  SUBGROUP  =  VC
2  ENTRIES [*]
3  PREF_EXISTS_IND  =  I2
3  ENTRY  =  VC
3  VALUES [*]
4  VALUE  =  VC
1  STATUS_DATA
2  STATUS  =  C1
2  SUBEVENTSTATUS [1 ]
3  OPERATIONNAME  =  C25
3  OPERATIONSTATUS  =  C1
3  TARGETOBJECTNAME  =  C25
3  TARGETOBJECTVALUE  =  VC )
ENDIF
 
SET  STAT  =  ALTERLIST ( PREF_REQ -> PREF , 1 )
SET  STAT  =  ALTERLIST ( PREF_REQ -> PREF [1 ]-> CONTEXTS , 2 )
SET  STAT  =  ALTERLIST ( PREF_REQ -> PREF [1 ]-> ENTRIES , 1 )
SET  PREF_REQ -> PREF [1 ]-> CONTEXTS [1 ]-> CONTEXT  = "organization"
SET  PREF_REQ -> PREF [1 ]-> CONTEXTS [1 ]-> CONTEXT_ID  =  SCUR_TRUST
SET  PREF_REQ -> PREF [1 ]-> CONTEXTS [2 ]-> CONTEXT  = "default"
SET  PREF_REQ -> PREF [1 ]-> CONTEXTS [2 ]-> CONTEXT_ID  = "system"
SET  PREF_REQ -> PREF [1 ]-> SECTION  = "workflow"
SET  PREF_REQ -> PREF [1 ]-> SECTION_ID  = "UK Trust Security"
SET  PREF_REQ -> PREF [1 ]-> ENTRIES [1 ]-> ENTRY  = "dynamic organizations"
 EXECUTE PPR_PREFERENCES WITH  REPLACE ("ptlst_request" , "PREF_REQ" ),
 REPLACE ("ptlstEncntr_reply" , "PREF_REP" )
IF ( ( CNVTUPPER ( PREF_REP -> PREF [1 ]-> ENTRIES [1 ]-> VALUES [1 ]-> VALUE )="ENABLED" ) )
 RETURN ( IS_ENABLED )
 
ELSE   RETURN ( IS_DISABLED )
 
ENDIF
 
 
END ;Subroutine
 
DECLARE  HPROP  =  I4  WITH  PROTECT , NOCONSTANT (0 )
DECLARE  TMPSTAT  =  I2
DECLARE  SPROPNAME  =  VC
DECLARE  SROLEPROFILE  =  VC
SET  HPROP  =  UAR_SRVCREATEPROPERTY ()
SET  TMPSTAT  =  UAR_SECGETCLIENTATTRIBUTESEXT (5 ,  HPROP )
SET  SPROPNAME  =  UAR_SRVFIRSTPROPERTY ( HPROP )
SET  SROLEPROFILE  =  UAR_SRVGETPROPERTYPTR ( HPROP ,  NULLTERM ( SPROPNAME ))
SELECT  INTO "nl:"
FROM ( PRSNL_ORG_RELTN_TYPE  PRT ),
( PRSNL_ORG_RELTN  POR )
 PLAN ( PRT
WHERE (PRT.ROLE_PROFILE= SROLEPROFILE ) AND (PRT.ACTIVE_IND=1 ) AND (PRT.BEG_EFFECTIVE_DT_TM<=
 CNVTDATETIME ( CURDATE ,  CURTIME3 )) AND (PRT.END_EFFECTIVE_DT_TM> CNVTDATETIME ( CURDATE ,
 CURTIME3 )))
 AND ( POR
WHERE ( OUTERJOIN (PRT.ORGANIZATION_ID)=POR.ORGANIZATION_ID) AND (POR.PERSON_ID= OUTERJOIN (
PRT.PRSNL_ID)) AND (POR.ACTIVE_IND= OUTERJOIN (1 )) AND (POR.BEG_EFFECTIVE_DT_TM<= OUTERJOIN (
 CNVTDATETIME ( CURDATE ,  CURTIME3 ))) AND (POR.END_EFFECTIVE_DT_TM> OUTERJOIN ( CNVTDATETIME (
 CURDATE ,  CURTIME3 ))))
 
ORDER BY POR.PRSNL_ORG_RELTN_ID
 
DETAIL
 ORGCNT =1 ,
 SECSTAT = ALTERLIST ( SAC_ORG -> ORGANIZATIONS , 1 ),
 USER_PERSON_ID =PRT.PRSNL_ID,
 SAC_ORG -> ORGANIZATIONS [1 ]-> ORGANIZATION_ID =PRT.ORGANIZATION_ID,
 SAC_ORG -> ORGANIZATIONS [1 ]-> CONFID_CD =POR.CONFID_LEVEL_CD,
 CONFID_CD = UAR_GET_COLLATION_SEQ (POR.CONFID_LEVEL_CD),
 SAC_ORG -> ORGANIZATIONS [1 ]-> CONFID_LEVEL =
IF ( ( CONFID_CD >0 ) )  CONFID_CD
ELSE  0
ENDIF
 
 WITH  MAXREC =1
SET  DCUR_TRUSTID  =  SAC_ORG -> ORGANIZATIONS [1 ]-> ORGANIZATION_ID
SET  DYNAMIC_ORG_IND  =  GETDYNAMICORGPREF ( DCUR_TRUSTID )
 CALL UAR_SRVDESTROYHANDLE ( HPROP )
ENDIF
 
IF ( ( DYNAMIC_ORG_IND = DYNORG_DISABLED ) )
SELECT  DISTINCT  INTO "nl:"
FROM ( PRSNL_ORG_RELTN  POR )
 
WHERE (POR.PERSON_ID= REQINFO -> UPDT_ID ) AND (POR.ACTIVE_IND=1 ) AND (POR.BEG_EFFECTIVE_DT_TM<
 CNVTDATETIME ( CURDATE ,  CURTIME3 )) AND (POR.END_EFFECTIVE_DT_TM>= CNVTDATETIME ( CURDATE ,
 CURTIME3 ))
 
HEAD REPORT
 
IF ( ( ORGCNT >0 ) )  SECSTAT = ALTERLIST ( SAC_ORG -> ORGANIZATIONS , 10 )
ENDIF
 
DETAIL
 ORGCNT =( ORGCNT +1 ),
 
IF ( ( MOD ( ORGCNT , 10 )=1 ) )  SECSTAT = ALTERLIST ( SAC_ORG -> ORGANIZATIONS , ( ORGCNT +9 ))
ENDIF
,
 SAC_ORG -> ORGANIZATIONS [ ORGCNT ]-> ORGANIZATION_ID =POR.ORGANIZATION_ID,
 SAC_ORG -> ORGANIZATIONS [ ORGCNT ]-> CONFID_CD =POR.CONFID_LEVEL_CD,
 SAC_ORG -> ORGANIZATIONS [ ORGCNT ]-> CONFID_LEVEL =
IF ( ( UAR_GET_COLLATION_SEQ (POR.CONFID_LEVEL_CD)>0 ) )  UAR_GET_COLLATION_SEQ (POR.CONFID_LEVEL_CD
)
ELSE  0
ENDIF
 
FOOT REPORT
 SECSTAT = ALTERLIST ( SAC_ORG -> ORGANIZATIONS ,  ORGCNT )
 WITH  NOCOUNTER
ELSEIF ( ( DYNAMIC_ORG_IND = DYNORG_ENABLED ) )
DECLARE  NHSTRUSTCHILD_ORG_ORG_RELTN_CD  =  F8
SET  NHSTRUSTCHILD_ORG_ORG_RELTN_CD  =  UAR_GET_CODE_BY ("MEANING" , 369 , "NHSTRUSTCHLD" )
SELECT  INTO "nl:"
FROM ( ORG_ORG_RELTN  OOR )
 PLAN ( OOR
WHERE (OOR.ORGANIZATION_ID= DCUR_TRUSTID ) AND (OOR.ACTIVE_IND=1 ) AND (OOR.BEG_EFFECTIVE_DT_TM<
 CNVTDATETIME ( CURDATE ,  CURTIME3 )) AND (OOR.END_EFFECTIVE_DT_TM>= CNVTDATETIME ( CURDATE ,
 CURTIME3 )) AND (OOR.ORG_ORG_RELTN_CD= NHSTRUSTCHILD_ORG_ORG_RELTN_CD ))
 
 
HEAD REPORT
 
IF ( ( ORGCNT >0 ) )  SECSTAT = ALTERLIST ( SAC_ORG -> ORGANIZATIONS , 10 )
ENDIF
 
DETAIL
 
IF ( (OOR.RELATED_ORG_ID>0 ) )  ORGCNT =( ORGCNT +1 ),
IF ( ( MOD ( ORGCNT , 10 )=1 ) )  SECSTAT = ALTERLIST ( SAC_ORG -> ORGANIZATIONS , ( ORGCNT +9 ))
ENDIF
,  SAC_ORG -> ORGANIZATIONS [ ORGCNT ]-> ORGANIZATION_ID =OOR.RELATED_ORG_ID
ENDIF
 
FOOT REPORT
 SECSTAT = ALTERLIST ( SAC_ORG -> ORGANIZATIONS ,  ORGCNT )
 WITH  NOCOUNTER
ELSE
 CALL ECHO ( BUILD ("Unexpected login type: " ,  DYNAMIMC_ORG_IND ))
ENDIF
 
ENDIF
 
SET  ORG_CNT  =  SIZE ( SAC_ORG -> ORGANIZATIONS , 5 )
SET  STAT  =  ALTERLIST ( ORGS -> QUAL ,  ORG_CNT )
FOR (  COUNT  = 1  TO  ORG_CNT  )
 
SET  ORGS -> QUAL [ COUNT ]-> ORG_ID  =  SAC_ORG -> ORGANIZATIONS [ COUNT ]-> ORGANIZATION_ID
SET  ORGS -> QUAL [ COUNT ]-> CONFID_LEVEL  =  SAC_ORG -> ORGANIZATIONS [ COUNT ]-> CONFID_LEVEL
 
ENDFOR
 
ENDIF
 
IF ( ( ORG_CNT >0 ) )
SELECT  INTO "nl:"
FROM ( DUMMYT  D  WITH  SEQ = VALUE ( PATIENT_CNT )),
( DUMMYT  D2  WITH  SEQ = VALUE ( ORG_CNT ))
 PLAN ( D
WHERE ( ptlstEncntr_reply -> PATIENTS [D.SEQ]-> FILTER_IND =1 ))
 AND ( D2
WHERE ( ORGS -> QUAL [D2.SEQ]-> ORG_ID = ptlstEncntr_reply -> PATIENTS [D.SEQ]-> ORGANIZATION_ID ))
 
 
DETAIL
 
IF (  (( ( CONFID_IND =0 ) )  OR  (( ORGS -> QUAL [D2.SEQ]-> CONFID_LEVEL >= ptlstEncntr_reply -> PATIENTS [
D.SEQ]-> CONFID_LEVEL ) ))  )  ptlstEncntr_reply -> PATIENTS [D.SEQ]-> FILTER_IND =0
ENDIF
 
 WITH  NOCOUNTER
ENDIF
 
FREE SET ORGS
 
END ;Subroutine
 
 
SUBROUTINE   PERFORMRELATIONSHIPOVERRIDES  ( X  )
 
DECLARE  RELTNCNT  =  I4  WITH  NOCONSTANT (0 )
DECLARE  I  =  I4  WITH  NOCONSTANT (0 )
DECLARE  J  =  I4  WITH  NOCONSTANT (0 )
DECLARE  K  =  I4  WITH  NOCONSTANT (0 )
DECLARE  FOUND  =  I2  WITH  NOCONSTANT (0 ), PRIVATE
DECLARE  M  =  I4  WITH  NOCONSTANT (0 )
DECLARE  MIN_ENCNTRID  =  F8  WITH  NOCONSTANT (0.0 )
DECLARE  MAX_ENCNTRID  =  F8  WITH  NOCONSTANT (0.0 )
FREE SET TEMP
RECORD  TEMP  (
1  ENTITY_CNT  =  I4
1  ENTITIES [*]
2  ENTITY_ID  =  F8
2  ENTITY_INDEX  =  I4
1  PERSON_CNT  =  I4
1  PERSONS [*]
2  PERSON_ID  =  F8
2  OVERRIDE_LEVEL  =  I2
1  RELTNS [*]
2  PPR_CD  =  F8
2  OVERRIDE_TYPE  =  I4 )
SELECT  INTO "nl:"
FROM ( CODE_VALUE_EXTENSION  CVE )
 PLAN ( CVE
WHERE (CVE.CODE_SET=331 ) AND (CVE.FIELD_NAME="Override" ))
 
 
DETAIL
 RELTNCNT =( RELTNCNT +1 ),
 
IF ( ( MOD ( RELTNCNT , 10 )=1 ) )  STAT = ALTERLIST ( TEMP -> RELTNS , ( RELTNCNT +9 ))
ENDIF
,
 TEMP -> RELTNS [ RELTNCNT ]-> PPR_CD =CVE.CODE_VALUE,
 TEMP -> RELTNS [ RELTNCNT ]-> OVERRIDE_TYPE = CNVTINT (CVE.FIELD_VALUE),
 
IF ( ( TEMP -> RELTNS [ RELTNCNT ]-> OVERRIDE_TYPE <1 ) )  RELTNCNT =( RELTNCNT -1 )
ENDIF
 
 WITH  NOCOUNTER
IF ( ( RELTNCNT >0 ) )
SELECT  INTO "nl:"
FROM ( DUMMYT  D  WITH  SEQ = PATIENT_CNT )
 PLAN ( D
WHERE ( ptlstEncntr_reply -> PATIENTS [D.SEQ]-> FILTER_IND =1 ))
 
ORDER BY  ptlstEncntr_reply -> PATIENTS [D.SEQ]-> PERSON_ID
 
HEAD REPORT
 TEMP -> ENTITY_CNT =0
DETAIL
 
IF (  (( ( TEMP -> ENTITY_CNT =0 ) )  OR  (( TEMP -> ENTITIES [ TEMP -> ENTITY_CNT ]-> ENTITY_ID !=
 ptlstEncntr_reply -> PATIENTS [D.SEQ]-> PERSON_ID ) ))  )  TEMP -> ENTITY_CNT =( TEMP -> ENTITY_CNT +1 ),
IF ( ( MOD ( TEMP -> ENTITY_CNT , 100 )=1 ) )  STAT = ALTERLIST ( TEMP -> ENTITIES , ( TEMP ->
 ENTITY_CNT +99 ))
ENDIF
,  TEMP -> ENTITIES [ TEMP -> ENTITY_CNT ]-> ENTITY_ID = ptlstEncntr_reply -> PATIENTS [D.SEQ]-> PERSON_ID
ENDIF
 
 WITH  NOCOUNTER
IF ( ( TEMP -> ENTITY_CNT >0 ) )
SET  STAT  =  ALTERLIST ( TEMP -> PERSONS ,  TEMP -> ENTITY_CNT )
SELECT  INTO "nl:"
FROM ( PERSON_PRSNL_RELTN  PPR )
 PLAN ( PPR
WHERE (PPR.PRSNL_PERSON_ID= REQINFO -> UPDT_ID ) AND (PPR.ACTIVE_IND=1 ) AND  EXPAND ( I , 1 ,
 RELTNCNT , PPR.PERSON_PRSNL_R_CD,  TEMP -> RELTNS [ I ]-> PPR_CD ) AND  EXPAND ( J , 1 ,  TEMP ->
 ENTITY_CNT , (PPR.PERSON_ID+0 ),  TEMP -> ENTITIES [ J ]-> ENTITY_ID ))
 
ORDER BY PPR.PERSON_ID
 
HEAD REPORT
 TEMP -> PERSON_CNT =0
HEAD PPR.PERSON_ID
 TEMP -> PERSON_CNT =( TEMP -> PERSON_CNT +1 ), TEMP -> PERSONS [ TEMP -> PERSON_CNT ]-> PERSON_ID =
PPR.PERSON_ID
DETAIL
 RIDX = LOCATEVAL ( M , 1 ,  RELTNCNT , PPR.PERSON_PRSNL_R_CD,  TEMP -> RELTNS [ M ]-> PPR_CD ),
 TEMP -> PERSONS [ TEMP -> PERSON_CNT ]-> OVERRIDE_LEVEL = MAXVAL ( TEMP -> PERSONS [ TEMP ->
 PERSON_CNT ]-> OVERRIDE_LEVEL ,  TEMP -> RELTNS [ RIDX ]-> OVERRIDE_TYPE )
 WITH  NOCOUNTER
IF ( ( TEMP -> PERSON_CNT >0 ) )
SELECT  INTO "nl:"
FROM ( DUMMYT  D1  WITH  SEQ = TEMP -> PERSON_CNT ),
( DUMMYT  D2  WITH  SEQ = PATIENT_CNT )
 PLAN ( D1
WHERE ( TEMP -> PERSONS [D1.SEQ]-> OVERRIDE_LEVEL >0 ))
 AND ( D2
WHERE ( ptlstEncntr_reply -> PATIENTS [D2.SEQ]-> PERSON_ID = TEMP -> PERSONS [D1.SEQ]-> PERSON_ID ) AND ( ptlstEncntr_reply
-> PATIENTS [D2.SEQ]-> FILTER_IND =1 ))
 
 
DETAIL
 
IF (  (( ( TEMP -> PERSONS [D1.SEQ]-> OVERRIDE_LEVEL =2 ) )  OR  (( ptlstEncntr_reply -> PATIENTS [D2.SEQ]->
 CONFID_LEVEL =0 ) ))  )  ptlstEncntr_reply -> PATIENTS [D2.SEQ]-> FILTER_IND =0
ENDIF
 
 WITH  NOCOUNTER
ENDIF
 
ENDIF
 
ENDIF
 
SELECT  INTO "nl:"
FROM ( DUMMYT  D  WITH  SEQ = PATIENT_CNT )
 PLAN ( D
WHERE ( ptlstEncntr_reply -> PATIENTS [D.SEQ]-> FILTER_IND =1 ) AND ( ptlstEncntr_reply -> PATIENTS [D.SEQ]-> ENCNTR_ID >
0.0 ))
 
ORDER BY  ptlstEncntr_reply -> PATIENTS [D.SEQ]-> ENCNTR_ID
 
HEAD REPORT
 TEMP -> ENTITY_CNT =0
DETAIL
 TEMP -> ENTITY_CNT =( TEMP -> ENTITY_CNT +1 ),
 
IF ( ( MOD ( TEMP -> ENTITY_CNT , 100 )=1 ) )  STAT = ALTERLIST ( TEMP -> ENTITIES , ( TEMP ->
 ENTITY_CNT +99 ))
ENDIF
,
 TEMP -> ENTITIES [ TEMP -> ENTITY_CNT ]-> ENTITY_ID = ptlstEncntr_reply -> PATIENTS [D.SEQ]-> ENCNTR_ID ,
 TEMP -> ENTITIES [ TEMP -> ENTITY_CNT ]-> ENTITY_INDEX =D.SEQ
 WITH  NOCOUNTER
IF ( ( TEMP -> ENTITY_CNT >0 ) )
SET  J  = 1
WHILE ( ( J <= TEMP -> ENTITY_CNT ))
 
SET  K  =  MINVAL (( J +199 ),  TEMP -> ENTITY_CNT )
SELECT  INTO "nl:"
FROM ( ENCNTR_PRSNL_RELTN  EPR )
 PLAN ( EPR
WHERE  EXPAND ( M ,  J ,  K , EPR.ENCNTR_ID,  TEMP -> ENTITIES [ M ]-> ENTITY_ID ) AND (
EPR.PRSNL_PERSON_ID= REQINFO -> UPDT_ID ) AND (EPR.EXPIRATION_IND=0 ) AND (EPR.ACTIVE_IND=1 ) AND (
EPR.ENCNTR_PRSNL_R_CD>0 ) AND (EPR.BEG_EFFECTIVE_DT_TM< CNVTDATETIME ( CURDATE ,  CURTIME3 )) AND (
EPR.END_EFFECTIVE_DT_TM> CNVTDATETIME ( CURDATE ,  CURTIME3 )))
 
ORDER BY EPR.ENCNTR_ID
 
HEAD EPR.ENCNTR_ID
 I = LOCATEVAL ( M , 1 ,  TEMP -> ENTITY_CNT , EPR.ENCNTR_ID,  TEMP -> ENTITIES [ M ]-> ENTITY_ID ),
IF ( ( I >0 ) )  ptlstEncntr_reply -> PATIENTS [ TEMP -> ENTITIES [ I ]-> ENTITY_INDEX ]-> FILTER_IND =0
ENDIF
 
 WITH  NOCOUNTER
SET  J  = ( J +200 )
 
ENDWHILE
 
ENDIF
 
FREE SET TEMP
 
END ;Subroutine
 
 
SUBROUTINE   REMOVEFILTEREDPATIENTS  ( X  )
 
DECLARE  ACTUAL_CNT  =  I4  WITH  NOCONSTANT (0 )
SELECT  INTO "nl:"
FROM ( DUMMYT  D  WITH  SEQ = VALUE ( PATIENT_CNT ))
 PLAN ( D
WHERE ( ptlstEncntr_reply -> PATIENTS [D.SEQ]-> FILTER_IND =0 ))
 
 
HEAD REPORT
 ACTUAL_CNT =0
DETAIL
 ACTUAL_CNT =( ACTUAL_CNT +1 ),
 ptlstEncntr_reply -> PATIENTS [ ACTUAL_CNT ]-> PERSON_ID = ptlstEncntr_reply -> PATIENTS [D.SEQ]-> PERSON_ID ,
 ptlstEncntr_reply -> PATIENTS [ ACTUAL_CNT ]-> PERSON_NAME = ptlstEncntr_reply -> PATIENTS [D.SEQ]-> PERSON_NAME ,
 ptlstEncntr_reply -> PATIENTS [ ACTUAL_CNT ]-> ENCNTR_ID = ptlstEncntr_reply -> PATIENTS [D.SEQ]-> ENCNTR_ID ,
 ptlstEncntr_reply -> PATIENTS [ ACTUAL_CNT ]-> PRIORITY = ptlstEncntr_reply -> PATIENTS [D.SEQ]-> PRIORITY ,
 ptlstEncntr_reply -> PATIENTS [ ACTUAL_CNT ]-> ACTIVE_IND = ptlstEncntr_reply -> PATIENTS [D.SEQ]-> ACTIVE_IND ,
 ptlstEncntr_reply -> PATIENTS [ ACTUAL_CNT ]-> ORGANIZATION_ID = ptlstEncntr_reply -> PATIENTS [D.SEQ]-> ORGANIZATION_ID ,
 ptlstEncntr_reply -> PATIENTS [ ACTUAL_CNT ]-> CONFID_LEVEL_CD = ptlstEncntr_reply -> PATIENTS [D.SEQ]-> CONFID_LEVEL_CD ,
 ptlstEncntr_reply -> PATIENTS [ ACTUAL_CNT ]-> CONFID_LEVEL = ptlstEncntr_reply -> PATIENTS [D.SEQ]-> CONFID_LEVEL ,
 ptlstEncntr_reply -> PATIENTS [ ACTUAL_CNT ]-> FILTER_IND = ptlstEncntr_reply -> PATIENTS [D.SEQ]-> FILTER_IND ,
 ptlstEncntr_reply -> PATIENTS [ ACTUAL_CNT ]-> BIRTHDATE = ptlstEncntr_reply -> PATIENTS [D.SEQ]-> BIRTHDATE ,
 ptlstEncntr_reply -> PATIENTS [ ACTUAL_CNT ]-> BIRTH_TZ = ptlstEncntr_reply -> PATIENTS [D.SEQ]-> BIRTH_TZ ,
 ptlstEncntr_reply -> PATIENTS [ ACTUAL_CNT ]-> GENDER_CD = ptlstEncntr_reply -> PATIENTS [D.SEQ]-> GENDER_CD ,
 ptlstEncntr_reply -> PATIENTS [ ACTUAL_CNT ]-> VIP_CD = ptlstEncntr_reply -> PATIENTS [D.SEQ]-> VIP_CD ,
 ptlstEncntr_reply -> PATIENTS [ ACTUAL_CNT ]-> DECEASED_DATE = ptlstEncntr_reply -> PATIENTS [D.SEQ]-> DECEASED_DATE ,
 ptlstEncntr_reply -> PATIENTS [ ACTUAL_CNT ]-> DECEASED_TZ = ptlstEncntr_reply -> PATIENTS [D.SEQ]-> DECEASED_TZ ,
 ptlstEncntr_reply -> PATIENTS [ ACTUAL_CNT ]-> END_EFFECTIVE_DT_TM = ptlstEncntr_reply -> PATIENTS [D.SEQ]->
 END_EFFECTIVE_DT_TM ,
 ptlstEncntr_reply -> PATIENTS [ ACTUAL_CNT ]-> SERVICE_CD = ptlstEncntr_reply -> PATIENTS [D.SEQ]-> SERVICE_CD ,
 ptlstEncntr_reply -> PATIENTS [ ACTUAL_CNT ]-> TEMP_LOCATION_CD = ptlstEncntr_reply -> PATIENTS [D.SEQ]-> TEMP_LOCATION_CD ,
 ptlstEncntr_reply -> PATIENTS [ ACTUAL_CNT ]-> VISIT_REASON = ptlstEncntr_reply -> PATIENTS [D.SEQ]-> VISIT_REASON ,
 ptlstEncntr_reply -> PATIENTS [ ACTUAL_CNT ]-> VISITOR_STATUS_CD = ptlstEncntr_reply -> PATIENTS [D.SEQ]->
 VISITOR_STATUS_CD
FOOT REPORT
 PATIENT_CNT = ACTUAL_CNT ,
 STAT = ALTERLIST ( ptlstEncntr_reply -> PATIENTS ,  PATIENT_CNT )
 WITH  NOCOUNTER
SET  PATIENT_CNT  =  ACTUAL_CNT
SET  STAT  =  ALTERLIST ( ptlstEncntr_reply -> PATIENTS ,  PATIENT_CNT )
 
END ;Subroutine
 
 
SUBROUTINE   PARSEENCOUNTERBYENCNTR  ( CONDITION ,  USECENSUSCRITIERIA  )
 
DECLARE  TXT  =  VC  WITH  NOCONSTANT ( FILLSTRING (50 , " " )), PRIVATE
SET  TXT  =  CONCAT ("join E where " ,  CONDITION )
 CALL PARSER ( TXT )
 CALL PARSER ("and (E.active_ind = 1 or E.encntr_id = 0.0)" )
IF ( ( CRITERIA -> TIME_FRAME_FLAG = NOTIMEPARAMETER ) AND ( CRITERIA -> TYPE_CNT >0 ) )
 CALL PARSER (
" and expand (typeX, 1, criteria->type_cnt, E.encntr_type_cd+0, criteria->types[typeX].encntr_type_cd)"
)
ENDIF
 
IF ( ( USECENSUSCRITIERIA =1 ) AND ( CRITERIA -> TIME_FRAME_FLAG = NOTIMEPARAMETER ) AND ( CRITERIA
-> SERVICE_CNT >0 ) )
 CALL PARSER (
" and expand (serviceX, 1, criteria->service_cnt, E.med_service_cd+0, criteria->services[serviceX].service_cd)"
)
ENDIF
 
IF ( ( USECENSUSCRITIERIA =1 ) AND ( CRITERIA -> TIME_FRAME_FLAG = NOTIMEPARAMETER ) )
IF ( ( CRITERIA -> LOCATIONS -> BED_CNT >0 ) )
 CALL PARSER (" and expand (locX, 1, criteria->locations.bed_cnt, E.loc_bed_cd," )
 CALL PARSER (" criteria->locations.beds[locX].bed_cd)" )
ELSEIF ( ( CRITERIA -> LOCATIONS -> ROOM_CNT >0 ) )
 CALL PARSER (" and expand (locX, 1, criteria->locations.room_cnt, E.loc_room_cd," )
 CALL PARSER (" criteria->locations.rooms[locX].room_cd)" )
ELSEIF ( ( CRITERIA -> LOCATIONS -> UNIT_CNT >0 ) )
 CALL PARSER (" and expand (locX, 1, criteria->locations.unit_cnt, E.loc_nurse_unit_cd," )
 CALL PARSER (" criteria->locations.units[locX].unit_cd)" )
ELSEIF ( ( CRITERIA -> LOCATIONS -> BUILDING_CNT >0 ) )
 CALL PARSER (" and expand (locX, 1, criteria->locations.building_cnt, E.loc_building_cd," )
 CALL PARSER (" criteria->locations.buildings[locX].building_cd)" )
ELSEIF ( ( CRITERIA -> LOCATIONS -> FACILITY_CNT >0 ) )
 CALL PARSER (" and expand (locX, 1, criteria->locations.facility_cnt, E.loc_facility_cd," )
 CALL PARSER (" criteria->locations.facilities[locX].facility_cd)" )
ENDIF
 
ENDIF
 
IF ( ( CRITERIA -> ADMIT_FLAG >0 ) AND ( CRITERIA -> LOOKFORWARD_ADMIT_FLAG =0 ) )
 CALL PARSER (" and e.reg_dt_tm > cnvtdatetime(criteria->admit_dt_tm)" )
ELSEIF ( ( CRITERIA -> ADMIT_FLAG =0 ) AND ( CRITERIA -> LOOKFORWARD_ADMIT_FLAG >0 ) )
 CALL PARSER (" and e.reg_dt_tm < cnvtdatetime(criteria->lookforward_admit_dt_tm)" )
ELSEIF ( ( CRITERIA -> ADMIT_FLAG >0 ) AND ( CRITERIA -> LOOKFORWARD_ADMIT_FLAG >0 ) )
 CALL PARSER (
" and e.reg_dt_tm between cnvtdatetime(criteria->admit_dt_tm) and cnvtdatetime(criteria->lookforward_admit_dt_tm)"
)
ENDIF
 
IF ( ( CRITERIA -> DISCHARGE_FLAG =1 ) )
 CALL PARSER (" and e.disch_dt_tm >= cnvtdatetime(criteria->disch_dt_tm)" )
 CALL PARSER (" and e.disch_dt_tm <= cnvtdatetime(curdate, curtime3)" )
ELSEIF ( ( CRITERIA -> DISCHARGE_FLAG =2 ) )
 CALL PARSER (" and (nullind(e.disch_dt_tm) = 1" )
 CALL PARSER (" or e.disch_dt_tm >= cnvtdatetime(criteria->disch_dt_tm))" )
ENDIF
 
 
END ;Subroutine
 
 
SUBROUTINE   PARSEENCNTRLOCHISTBYENCNTR  ( ALIAS  )
 
DECLARE  TEXT  =  VC  WITH  NOCONSTANT ( FILLSTRING (25 , " " )), PRIVATE
SET  TEXT  =  CONCAT ("join ELH where ELH.encntr_id = " ,  ALIAS )
 CALL PARSER ( TEXT )
IF ( ( CRITERIA -> TIME_FRAME_FLAG = TIMERANGEPARAMETER ) )
 CALL PARSER ("and ELH.end_effective_dt_tm >= cnvtdate(criteria->beg_effective_dt_tm)" )
 CALL PARSER ("and ELH.beg_effective_dt_tm <= cnvtdate(criteria->end_effective_dt_tm)" )
ELSE
 CALL PARSER ("and ELH.end_effective_dt_tm >= cnvtdate(criteria->end_effective_dt_tm)" )
 CALL PARSER ("and ELH.beg_effective_dt_tm >= cnvtdate(criteria->beg_effective_dt_tm)" )
ENDIF
 
 CALL PARSER ("and ELH.active_ind = 1" )
IF ( ( CRITERIA -> LOCATIONS -> BED_CNT >0 ) )
 CALL PARSER (" and expand (locX, 1, criteria->locations.bed_cnt, ELH.loc_bed_cd," )
 CALL PARSER (" critiera->locations.beds[locX].bed_cd)" )
ELSEIF ( ( CRITERIA -> LOCATIONS -> ROOM_CNT >0 ) )
 CALL PARSER (" and expand (locX, 1, criteria->locations.room_cnt, ELH.loc_room_cd," )
 CALL PARSER (" criteria->locations.rooms[locX].room_cd)" )
ELSEIF ( ( CRITERIA -> LOCATIONS -> UNIT_CNT >0 ) )
 CALL PARSER ("and expand(locX, 1, criteria->locations.unit_cnt, ELH.loc_nurse_unit_cd," )
 CALL PARSER (" criteria->locations.units[locX].unit_cd)" )
ELSEIF ( ( CRITERIA -> LOCATIONS -> BUILDING_CNT >0 ) )
 CALL PARSER ("and expand(locX, 1, criteria->locations.building_cnt, ELH.loc_building_cd, " )
 CALL PARSER (" criteria->locations.buildings[locX].building_cd)" )
ELSEIF ( ( CRITERIA -> LOCATIONS -> FACILITY_CNT >0 ) )
 CALL PARSER (" and expand(locX, 1, criteria->locations.facility_cnt, ELH.loc_facility_cd," )
 CALL PARSER (" criteria->locations.facilities[locX].facility_cd)" )
ENDIF
 
IF ( ( CRITERIA -> SERVICE_CNT >0 ) )
 CALL PARSER ("and expand (serviceX, 1, criteria->service_cnt, ELH.med_service_cd," )
 CALL PARSER (" criteria->services[serviceX].service_cd)" )
ENDIF
 
IF ( ( CRITERIA -> TYPE_CNT >0 ) )
 CALL PARSER (
"and expand (typeX, 1, criteria->type_cnt, ELH.encntr_type_cd, criteria->types[typeX].encntr_type_cd)"
)
ENDIF
 
 
END ;Subroutine
 
 
SUBROUTINE   PARSEEPR  ( ALIAS  )
 
DECLARE  TEXT  =  VC  WITH  NOCONSTANT ( FILLSTRING (50 , " " )), PRIVATE
SET  TEXT  =  CONCAT ("join EPR where EPR.encntr_id = " ,  ALIAS )
 CALL PARSER ( TEXT )
IF ( ( CRITERIA -> VRELTN_CNT >0 ) )
 CALL PARSER (
"and expand (visitX, 1, criteria->vreltn_cnt, EPR.encntr_prsnl_r_cd, criteria->vreltns[visitX].vreltn_cd)"
)
ENDIF
 
 CALL PARSER ("and EPR.prsnl_person_id+0 = criteria->reltn_prsnl_id" )
 CALL PARSER ("and EPR.active_ind = 1" )
IF ( ( CRITERIA -> TIME_FRAME_FLAG = TIMERANGEPARAMETER ) )
 CALL PARSER ("and EPR.end_effective_dt_tm >= cnvtdatetime(criteria->beg_effective_dt_tm)" )
 CALL PARSER ("and EPR.expire_dt_tm >= cnvtdatetime(criteria->beg_effective_dt_tm)" )
 CALL PARSER ("and EPR.beg_effective_dt_tm <= cnvtdatetime(criteria->end_effective_dt_tm)" )
ELSEIF ( ( CRITERIA -> TIME_FRAME_FLAG = NOTIMEPARAMETER ) )
 CALL PARSER ("and EPR.expiration_ind+0 = 0" )
 CALL PARSER ("and EPR.end_effective_dt_tm >= cnvtdatetime(curdate, curtime3)" )
ELSE
 CALL PARSER ("and EPR.end_effective_dt_tm >= cnvtdatetime(criteria->end_effective_dt_tm)" )
 CALL PARSER (
"and (EPR.expiration_ind = 0 or EPR.expire_dt_tm >= cnvtdatetime(criteria->end_effective_dt_tm))" )
 CALL PARSER ("and EPR.beg_effective_dt_tm >= cnvtdatetime(criteria->beg_effective_dt_tm)" )
ENDIF
 
 
END ;Subroutine
 
 
SUBROUTINE   PARSEPPR  ( ALIAS  )
 
DECLARE  TEXT  =  VC  WITH  NOCONSTANT ( FILLSTRING (50 , " " )), PRIVATE
SET  TEXT  =  CONCAT ("join PPR where PPR.person_id = " ,  ALIAS )
 CALL PARSER ( TEXT )
 CALL PARSER ("and PPR.prsnl_person_id+0 = criteria->reltn_prsnl_id" )
IF ( ( CRITERIA -> LRELTN_CNT >0 ) )
 CALL PARSER (
"and expand (lifeX, 1, criteria->lreltn_cnt, PPR.person_prsnl_r_cd, criteria->lreltns[lifeX].lreltn_cd)"
)
ENDIF
 
 CALL PARSER ("and PPR.active_ind = 1" )
IF ( ( CRITERIA -> TIME_FRAME_FLAG = TIMERANGEPARAMETER ) )
 CALL PARSER ("and PPR.end_effective_dt_tm >= cnvtdatetime(criteria->beg_effective_dt_tm)" )
 CALL PARSER ("and PPR.beg_effective_dt_tm <= cnvtdatetime(criteria->end_effective_dt_tm)" )
ELSEIF ( ( CRITERIA -> TIME_FRAME_FLAG = NOTIMEPARAMETER ) )
 CALL PARSER ("and PPR.end_effective_dt_tm >= cnvtdatetime(curdate, curtime3)" )
ELSE
 CALL PARSER ("and PPR.end_effective_dt_tm >= cnvtdatetime(criteria->end_effective_dt_tm)" )
 CALL PARSER ("and PPR.beg_effective_dt_tm >= cnvtdatetime(criteria->beg_effective_dt_tm)" )
ENDIF
 
 
END ;Subroutine
 
 
SUBROUTINE   ASSIGNPRIORITIES  ( X  )
 
DECLARE  I  =  I4  WITH  NOCONSTANT (0 ), PRIVATE
DECLARE  J  =  I4  WITH  NOCONSTANT (0 ), PRIVATE
DECLARE  K  =  I4  WITH  NOCONSTANT (0 ), PRIVATE
DECLARE  FOUND  =  I2  WITH  NOCONSTANT (0 ), PRIVATE
DECLARE  M  =  I4  WITH  NOCONSTANT (0 )
FREE SET TEMP
RECORD  TEMP  (
1  PERSON_CNT  =  I4
1  PERSONS [*]
2  PERSON_ID  =  F8
2  PRIORITY  =  I4 )
IF ( ( ptlst_request -> PATIENT_LIST_ID >0 ) AND ( PATIENT_CNT >0 ) )
SET  TEMP -> PERSON_CNT  = 0
SELECT  INTO "nl:"
FROM ( DCP_PL_PRIORITIZATION  PR )
 PLAN ( PR
WHERE (PR.PATIENT_LIST_ID= ptlst_request -> PATIENT_LIST_ID ) AND  EXPAND ( M , 1 ,  PATIENT_CNT , (
PR.PERSON_ID+0 ),  ptlstEncntr_reply -> PATIENTS [ M ]-> PERSON_ID ))
 
 
DETAIL
 TEMP -> PERSON_CNT =( TEMP -> PERSON_CNT +1 ),
 
IF ( ( MOD ( TEMP -> PERSON_CNT , 25 )=1 ) )  STAT = ALTERLIST ( TEMP -> PERSONS , ( TEMP ->
 PERSON_CNT +24 ))
ENDIF
,
 TEMP -> PERSONS [ TEMP -> PERSON_CNT ]-> PERSON_ID =PR.PERSON_ID,
 TEMP -> PERSONS [ TEMP -> PERSON_CNT ]-> PRIORITY =PR.PRIORITY
 WITH  NOCOUNTER
FOR (  J  = 1  TO  TEMP -> PERSON_CNT  )
 
FOR (  I  = 1  TO  PATIENT_CNT  )
 
IF ( ( ptlstEncntr_reply -> PATIENTS [ I ]-> PERSON_ID = TEMP -> PERSONS [ J ]-> PERSON_ID ) )
SET  ptlstEncntr_reply -> PATIENTS [ I ]-> PRIORITY  =  TEMP -> PERSONS [ J ]-> PRIORITY
ENDIF
 
 
ENDFOR
 
 
ENDFOR
 
ENDIF
 
FREE SET TEMP
 
END ;Subroutine
 
 
SUBROUTINE   PERFORMBESTENCNTR  ( N  )
 
RECORD  ENCNTRptlst_request  (
1  PERSONS [*]
2  PERSON_ID  =  F8 )
RECORD  ENCNTRptlstEncntr_reply  (
1  ENCOUNTERS [*]
2  ENCNTR_ID  =  F8
2  PERSON_ID  =  F8
1  LOOKUP_STATUS  =  I4
1  STATUS_DATA
2  STATUS  =  C1
2  SUBEVENTSTATUS [1 ]
3  OPERATIONNAME  =  C25
3  OPERATIONSTATUS  =  C1
3  TARGETOBJECTNAME  =  C25
3  TARGETOBJECTVALUE  =  VC )
DECLARE  PATCOUNT  =  I4  WITH  CONSTANT ( SIZE ( ptlstEncntr_reply -> PATIENTS , 5 )), PRIVATE
DECLARE  ENCNTRCNT  =  I4  WITH  NOCONSTANT (0 ), PRIVATE
DECLARE  X  =  I4  WITH  NOCONSTANT (0 ), PRIVATE
DECLARE  Y  =  I4  WITH  NOCONSTANT (0 ), PRIVATE
SET  STAT  =  ALTERLIST ( ENCNTRptlst_request -> PERSONS ,  PATCOUNT )
FOR (  X  = 1  TO  PATCOUNT  )
 
IF ( ( ptlstEncntr_reply -> PATIENTS [ X ]-> ENCNTR_ID =0 ) )
SET  ENCNTRptlst_request -> PERSONS [ X ]-> PERSON_ID  =  ptlstEncntr_reply -> PATIENTS [ X ]-> PERSON_ID
SET  ENCNTRCNT  = ( ENCNTRCNT +1 )
ENDIF
 
 
ENDFOR
 
IF ( ( ENCNTRCNT >0 ) )
SET  STAT  =  ALTERLIST ( ENCNTRptlst_request -> PERSONS ,  ENCNTRCNT )
 EXECUTE PTS_GET_BEST_ENCNTR_LIST WITH  REPLACE ( ptlst_request ,  ENCNTRptlst_request ),
 REPLACE ( ptlstEncntr_reply ,  ENCNTRptlstEncntr_reply )
SET  ENCNTR_CNT  =  SIZE ( ENCNTRptlstEncntr_reply -> ENCOUNTERS , 5 )
FOR (  X  = 1  TO  ENCNTRCNT  )
 
FOR (  Y  = 1  TO  PATCOUNT  )
 
IF ( ( ptlstEncntr_reply -> PATIENTS [ Y ]-> PERSON_ID = ENCNTRptlstEncntr_reply -> ENCOUNTERS [ X ]-> PERSON_ID ) AND (
 ptlstEncntr_reply -> PATIENTS [ Y ]-> ENCNTR_ID =0 ) )
SET  ptlstEncntr_reply -> PATIENTS [ Y ]-> ENCNTR_ID  =  ENCNTRptlstEncntr_reply -> ENCOUNTERS [ X ]-> ENCNTR_ID
SET  Y  = ( PATCOUNT +1 )
ENDIF
 
 
ENDFOR
 
 
ENDFOR
 
ENDIF
 
FREE RECORD ENCNTRptlstEncntr_reply
FREE RECORD ENCNTRptlst_request
 
END ;Subroutine
 
 
DECLARE  PATIENT_CNT  =  I4  WITH  NOCONSTANT (0 )
 
DECLARE  EXECUTEPRIMARYSELECT (( X = I4 )) =  NULL
 
SET  ptlstEncntr_reply -> STATUS_DATA -> STATUS  = "F"
 
 CALL EXAMINEORGSECURITY (1 )
 
 CALL INITIALIZECRITERIA (1 )
 
 CALL PARSEARGUMENTS (1 )
 
 CALL STANDARDIZELOCATIONS (1 )
 
 CALL STANDARDIZEENCNTRCLASSES (1 )
 
 CALL EXECUTEPRIMARYSELECT (1 )
 
SET  STAT  =  ALTERLIST ( ptlstEncntr_reply -> PATIENTS ,  PATIENT_CNT )
 
IF ( ( ENCNTR_ORG_SEC_IND =1 ) AND ( PATIENT_CNT >0 ) )
 CALL PERFORMORGSECURITY (1 )
 CALL PERFORMRELATIONSHIPOVERRIDES (1 )
 CALL REMOVEFILTEREDPATIENTS (1 )
ENDIF
 
 
 CALL ASSIGNPRIORITIES (1 )
 
FREE SET CRITERIA
 
IF ( ( PATIENT_CNT =0 ) )
SET  ptlstEncntr_reply -> STATUS_DATA -> STATUS  = "Z"
ELSE
SET  ptlstEncntr_reply -> STATUS_DATA -> STATUS  = "S"
ENDIF
 
 
SUBROUTINE   EXECUTEPRIMARYSELECT  ( X  )
 
 CALL PARSER ("select distinct into 'nl:'" )
 CALL PARSER ("CE.person_id, CE.encntr_id" )
 CALL PARSER ("from DCP_PL_CUSTOM_ENTRY CE" )
 CALL PARSER (", PERSON P" )
 CALL PARSER (", ENCOUNTER E" )
 CALL PARSER ("plan CE where" )
 CALL PARSER ("CE.patient_list_id = ptlst_request->patient_list_id" )
 CALL PARSEENCOUNTERBYENCNTR ("E.encntr_id = CE.encntr_id" , 1 )
 CALL PARSER ("join P where P.person_id = CE.person_id and P.active_ind = 1" )
 CALL PARSER ("order by CE.person_id, CE.encntr_id" )
 CALL PARSER ("detail" )
 CALL PARSER ("patient_cnt = patient_cnt +1" )
 CALL PARSER ("if(mod(patient_cnt,50) = 1)" )
 CALL PARSER ("stat = alterlist (ptlstEncntr_reply->patients, patient_cnt + 49)" )
 CALL PARSER ("endif" )
 CALL PARSER ("ptlstEncntr_reply->patients[patient_cnt].person_id = P.person_id" )
 CALL PARSER ("ptlstEncntr_reply->patients[patient_cnt].person_name = P.name_full_formatted" )
 CALL PARSER ("ptlstEncntr_reply->patients[patient_cnt].encntr_id = E.encntr_id" )
 CALL PARSER ("ptlstEncntr_reply->patients[patient_cnt].priority = 0" )
 CALL PARSER ("ptlstEncntr_reply->patients[patient_cnt].active_ind = 1" )
 CALL PARSER ("ptlstEncntr_reply->patients[patient_cnt].organization_id = E.organization_id" )
 CALL PARSER ("ptlstEncntr_reply->patients[patient_cnt].confid_level_cd = E.confid_level_cd" )
 CALL PARSER (
"ptlstEncntr_reply->patients[patient_cnt].confid_level = uar_get_collation_seq(E.confid_level_cd)" )
IF ( ( ptlstEncntr_reply -> PATIENTS [ PATIENT_CNT ]-> CONFID_LEVEL <0 ) )
 CALL PARSER ("ptlstEncntr_reply->patients[patient_cnt].confid_level = 0" )
ENDIF
 
IF ( ( ENCNTR_ORG_SEC_IND =0 ) )
 CALL PARSER ("ptlstEncntr_reply->patients[patient_cnt].filter_ind = 0" )
ELSE
 CALL PARSER ("if(e.encntr_id = 0)" )
 CALL PARSER ("ptlstEncntr_reply->patients[patient_cnt].filter_ind = 0" )
 CALL PARSER ("else " )
 CALL PARSER ("ptlstEncntr_reply->patients[patient_cnt].filter_ind = 1" )
 CALL PARSER ("endif" )
ENDIF
 
 CALL PARSER ("with nocounter go" )
 
END ;Subroutine
 ;get patient demog info
SET VIEWS CHECK

/* 
SELECT INTO  "nl:"
from (dummyt d with seq = size(ptlstEncntr_reply->patients,5))
	,cust_pt_demo_view c
plan d
join c
	where c.encntr_id = ptlstEncntr_reply->patients[d.seq].encntr_id
order by d.seq
head d.seq
	ptlstEncntr_reply->patients[d.seq].room = c.room
	ptlstEncntr_reply->patients[d.seq].bed = c.bed
	ptlstEncntr_reply->patients[d.seq].age = cnvtage(c.birth_dt_tm)
	ptlstEncntr_reply->patients[d.seq].sex = c.gender
	ptlstEncntr_reply->patients[d.seq].mrn = c.mrn
	ptlstEncntr_reply->patients[d.seq].fin = c.fin
	ptlstEncntr_reply->patients[d.seq].med_service = c.medical_service
with nocounter
*/

 END GO
 
 
